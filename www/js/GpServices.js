!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("xmldom"),require("request")):"function"==typeof define&&define.amd?define("Gp",["require","require"],t):"object"==typeof exports?exports.Gp=t(require("xmldom"),require("request")):e.Gp=t(e[void 0],e[void 0])}("undefined"!=typeof self?self:this,function(e,t){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=44)}([function(e,t,r){"use strict";var o=r(48),n=(r.n(o),{getLogger:function(e){"true".match(/true/)?o.disableAll():o.enableAll();var t=e||"default";return o.getLogger(t)}});t.a=n},function(e,t,r){"use strict";var o={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(e,t){if(0===Object.keys(arguments).length)return"Message indefined !";var r=Array.prototype.slice.call(arguments),o=r.shift(),n=r,s=this[o];try{s=Array.isArray(n)&&n.length>0?s.replace("%var%",n.join(" - ")):s.replace("%var%","%var% (not specified)")}catch(e){}return s}};t.a=o},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("ErrorService constructor cannot be called as a function.");var t=e;"string"==typeof e||e instanceof String?(this.message=e,this.status=-1,this.type=o.TYPE_UNKERR):(this.message=t.message||"undefined!?",this.type=t.type,this.status=t.status||-1),this.name="ErrorService",this.stack=(new Error).stack}o.TYPE_SRVERR="SERVICE_ERROR",o.TYPE_USEERR="USAGE_ERROR",o.TYPE_UNKERR="UNKNOWN_ERROR",o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),t.a=o},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(i.a.getMessage("CLASS_CONSTRUCTOR"));this.logger=n.a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(e){console.log("onSuccess - la reponse est la suivante : ",e)},onFailure:function(e){200!==e.status&&e.status?console.log("onFailure - Erreur (",e.status,") : ",e.message):console.log("onFailure : ",e.message)}};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(i.a.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(e){console.log("onSuccess - la réponse brute du service est la suivante : ",e)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(i.a.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){c.a.ssl=this.options.ssl;var r=c.a[this.CLASSNAME].url(this.options.apiKey);"string"==typeof r?this.options.serverUrl=r:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof e.httpMethod?e.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(i.a.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(i.a.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof e.protocol?e.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(i.a.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(i.a.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=e.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}var n=r(0),s=r(4),i=r(1),a=r(49),l=r(2),c=r(5),u=r(21),p=r.n(u);o.prototype={constructor:o,call:function(){function e(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(s,n,t)}function t(e){this.logger.trace("CommonService::onBuildRequest : ",e),this.callService.call(s,n,r)}function r(e){this.logger.trace("CommonService::onCallService : ",e),this.analyzeResponse.call(s,n,o)}function o(e){if(this.logger.trace("CommonService::onAnalyzeResponse : ",e),!e)return n.call(this,new l.a("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,e)}function n(e){this.logger.trace("CommonService::onError()");var t=e;t instanceof l.a||(t=new l.a(e.message)),this.options.onFailure.call(this,t)}this.logger.trace("CommonService::call ()");var s=this;e.call(s)},buildRequest:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")},callService:function(e,t){var r=null,o=this.request,n=!(!this.options.proxyURL||"XHR"!==this.options.protocol);this.options.serverUrl=s.a.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":p.a.version},!1),n&&("GET"===this.options.httpMethod&&(r=this.options.proxyURL+s.a.normalyzeUrl(this.options.serverUrl,this.request,!0),o=null),"POST"===this.options.httpMethod&&(r=this.options.proxyURL+s.a.normalyzeUrl(this.options.serverUrl,null,!0),o=this.request));var i=this,c={url:r||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:o,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(r){i.logger.trace("callService::onResponse()");var o=null;if("XHR"===i.options.protocol&&(i.logger.trace("Response XHR",r),o=r),"JSONP"===i.options.protocol){if(i.logger.trace("Response JSON",r),!r)return void e.call(i,new l.a("Le contenu de la reponse est vide !?"));if(r.http){if(200!==r.http.status)return void e.call(i,new l.a({status:r.http.status,message:r.http.error,type:l.a.TYPE_SRVERR}));o=r.xml,i.options.rawResponse&&(o=r)}else o=r}if("function"==typeof i.options.onBeforeParse){var n=i.options.onBeforeParse(o);"string"==typeof n&&(o=n)}i.response=o,t.call(i,o)},onFailure:function(t){i.logger.trace("callService::onFailure()"),t.type=l.a.TYPE_SRVERR,e.call(i,new l.a(t))},onTimeOut:function(){i.logger.trace("callService::onTimeOut()"),e.call(i,new l.a("TimeOut!"))}};a.a.send(c)},analyzeResponse:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")}},t.a=o},function(e,t,r){"use strict";var o={normalyzeParameters:function(e){var t=null;if(e){var r=[];for(var o in e)if(e.hasOwnProperty(o)){var n=e[o];n||(n=""),r.push(o+"="+n)}t=r.join("&")}return t},normalyzeUrl:function(e,t,r){var o=e;if(e){var n=e.indexOf("?");-1===n&&(o+="?"),-1!==n&&n!==e.length-1&&(o+="&")}return t&&(o+="string"==typeof t?t:this.normalyzeParameters(t)),r&&(o=encodeURIComponent(o)),o},indent:function(e,t){var r=e||0;return new Array(r+1).join("\t")+t}};t.a=o},function(e,t,r){"use strict";var o="wxs.ign.fr",n={ssl:!0,url:function(e,t){return(!1===n.ssl?"http://":"https://")+o.concat("/",e,t)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(e){return{"elevation-json":n.url(e,this._key["elevation-json"]),"elevation-xml":n.url(e,this._key["elevation-xml"]),"profil-json":n.url(e,this._key["profil-json"]),"profil-xml":n.url(e,this._key["profil-xml"]),wps:n.url(e,this._key.wps)}}},ProcessIsoCurve:{_key:{"iso-json":"/isochrone/isochrone.json","iso-xml":"/isochrone/isochrone.xml"},url:function(e){return{"iso-json":n.url(e,this._key["iso-json"]),"iso-xml":n.url(e,this._key["iso-xml"])}}},AutoComplete:{_key:"/ols/apis/completion",url:function(e){return n.url(e,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(e){return n.url(e,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(e){var t="";if(Array.isArray(e)&&e.length>0){t=e[0];for(var r=1;r<e.length;r++)t+=","+e[r]}return{apiKey:n.url(e,this._key.apiKey),apiKeys:n.url(e[0],this._key.apiKeys).replace("%KEYS%",t),aggregate:n.url(e,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(e){return n.url(e,this._key)}},Route:{_key:{ols:"/itineraire/ols","route-json":"/itineraire/rest/route.json","route-xml":"/itineraire/rest/route.xml"},url:function(e){return{ols:n.url(e,this._key.ols),"route-json":n.url(e,this._key["route-json"]),"route-xml":n.url(e,this._key["route-xml"])}}}};t.a=n},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("XML constructor cannot be called as a function.");this.logger=l.a.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,e&&(e.xmlString&&"string"==typeof e.xmlString&&(this.xmlString=e.xmlString,this.xmlDoc=n(e.xmlString)),e.reader&&this.setReader(e.reader))}function n(e){if("undefined"==typeof window){return(new(0,r(20).DOMParser)).parseFromString(e,"text/xml")}var t,o,n="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){o=new window.ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(e);var s=o.parseError;if(s.errorCode)throw s.line&&s.linepos&&(n+="( ligne "+s.line+", colonne "+s.linepos),s.reason&&(n+=":  "+s.reason+")"),new Error(n);return o}if(window.DOMParser){t=new window.DOMParser;try{o=t.parseFromString(e,"text/xml")}catch(e){throw"SyntaxError"===e.message?new Error(n):new Error("Erreur lors du parsing de la réponse du service : "+e.message)}if(o.getElementsByTagName("parsererror").length>0)for(var i=o.getElementsByTagName("parsererror"),a=0;a<i.length;a++){var l=i[a].innerHTML;if(-1===l.indexOf("Huge input lookup"))throw n+="("+l+")",new Error(n)}else if(!o.documentElement)throw new Error(n);return o}throw new Error("Incompatible DOM Parser pour ce navigateur !")}function s(e){var t;return 9===e.nodeType?t=e.documentElement:1===e.nodeType&&(t=e),t}function i(e){var t={};if(e.attributes.length>0){var r=a(e);t.attributes=r}if(e.hasChildNodes())for(var o,n={},s=e.childNodes,l=0;l<s.length;l++)if(o=s[l],3===o.nodeType)t.textContent=o.nodeValue;else if(1===o.nodeType)if(n=i(o),t[o.nodeName]){if(!Array.isArray(t[o.nodeName])){var c=t[o.nodeName];t[o.nodeName]=[],t[o.nodeName].push(c)}t[o.nodeName].push(n)}else t[o.nodeName]=n;return t}function a(e){if(e.attributes.length>0){for(var t={},r=e.attributes,o=0;o<r.length;o++){var n=r[o];t[n.nodeName]=n.nodeValue}return t}}var l=r(0);o.prototype={constructor:o,getXMLString:function(){return this.xmlString},setXMLString:function(e){e&&"string"==typeof e&&(this.xmlString=e,this.xmlDoc=n(e))},getReader:function(){return this.reader},setReader:function(e){e&&e.read&&"function"==typeof e.read&&(this.reader=e)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(e){this.xmlDoc=e},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=n(this.xmlString)),this.xmlDoc){var e=s(this.xmlDoc);if(e){var t;return this.reader&&this.reader.read?t=this.reader.read(e):(t={},t[e.nodeName]=i(e)),t}return{}}}},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("GeocodeLocation constructor cannot be called as a function.");this.placeAttributes={},this.attributesList=[],this.serviceAttributes=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";var o=r(0),n={toJson:function(e,t,r){var n=o.a.getLogger(),s=null;try{if(!e)throw new Error("La chaine WKT n'est pas renseignée !");t||(t=function(e){console.log(e)}),r||(r=function(e){console.log(e)});var i,a;if(i=/(-?\d+\.?[0-9]*)\s(-?\d+\.?[0-9]+)/g,a="[$1,$2]",e=e.replace(i,a),i=/^(\w+)/,i.exec(e),"POLYGON"===RegExp.$1?(a='{"type" : "Polygon",',e=e.replace(RegExp.$1,a),i=/(\({2}?)/,a='"coordinates" : [[',e=e.replace(i,a),i=/(\){2}?)/,a="]]}",e=e.replace(i,a),i=/(\()/g,a="[",e=e.replace(i,a),i=/(\))/g,a="]",e=e.replace(i,a)):"LINESTRING"===RegExp.$1&&(a='{"type" : "LineString",',e=e.replace(RegExp.$1,a),i=/(\(\(?)/,a='"coordinates" : [',e=e.replace(i,a),i=/(\)\)?)/,a="]}",e=e.replace(i,a)),n.trace(e),!(s=JSON.parse(e)))throw new Error("Le JSON est vide !");if(!s.type)throw new Error("Le type de geometrie n'est pas connu !");if(!s.coordinates)throw new Error("La liste des points est vide !");t.call(this,s)}catch(e){if("SyntaxError"===e.name)return void r.call(this,"Erreur de parsing JSON !");r.call(this,e)}}};t.a=n},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur XLS()]"),!(this instanceof o))throw new TypeError("XLS constructor cannot be called as a function.");this.options={srsName:"EPSG:4326",maximumResponses:25};for(var t in e)e.hasOwnProperty(t)&&e[t]&&(this.options[t]=e[t])}var n=r(0),s=r(66),i=r(67),a=r(12);o.VERSION="1.2",o.prototype={requestString:null,namespace:!1,oService:null,constructor:o,template:'<?xml version="1.0" encoding="UTF-8"?>\n<XLS version="__VERSION__"\n__NAMESPACE__ \n__SCHEMALOCATION__>\n__REQUESTHEADER__\n__REQUEST__\n</XLS>\n',namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns:xls="http://www.opengis.net/xls"','xmlns:gml="http://www.opengis.net/gml"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"'},setService:function(e){if(!e)return void this.logger.trace("L'objet de type Service XSL n'est pas encore defini !?");e instanceof a.a?this.oService=e:this.logger.error("L'objet n'est pas du type 'LocationUtilityService' ou 'RouteService' !?")},getService:function(){return this.oService}},o.prototype.addNamespace=function(e,t){for(var r=e.key,o=!1,n=this.namespaceByDefault().split(" "),s=0;s<n.length;s++){if(n[s].split("=")[0]==="xmlns:"+r){o=!0;break}}if(!o)return this.logger.warn("L'ajout d'un nouvel namespace n'est pas encore implémenté !"),t;var i,a;return i=/<(\w+[\s>])/g,a="<"+r+":$1",t=t.replace(i,a),i=/<\/(\w+[\s>])/g,a="</"+r+":$1",t=t.replace(i,a),this.logger.trace("namespace",t),t},o.prototype.build=function(){var e=!!this.getService(),t="";t=this.template,t=t.replace(/__VERSION__/g,o.VERSION),t=t.replace(/__NAMESPACE__/g,this.namespaceByDefault),t=t.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault);var r=new s.a({srsName:this.options.srsName});t=t.replace(/__REQUESTHEADER__/g,r.toString());var n=new i.a({maximumResponses:this.options.maximumResponses,version:o.VERSION,methodName:e?this.getService().CLASSTYPE:null});return t=t.replace(/__REQUEST__/g,n.toString()),e&&(t=t.replace(/<!-- __REQUESTSERVICE__ -->/g,this.getService().toString())),t?(this.namespace&&(t=this.addNamespace({key:"xls",url:"http://www.opengis.net/xls"},t)),this.requestString=t,this.logger.trace("traduction tmpl",t),this.requestString):void this.logger.warn("traduction tmpl : empty request !?")},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AbstractService ()]"),!(this instanceof o))throw new TypeError("AbstractService constructor cannot be called as a function.");this.options=e||{};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}var n=r(0);o.prototype={strRequest:null,oRequest:null,oFilter:null,constructor:o,addRequest:function(e){this.logger.error("overwritten method !")},addFilter:function(e){this.logger.error("overwritten method !")},toString:function(){this.logger.error("overwritten method !")}},t.a=o},function(e,t,r){"use strict";function o(){if(this.logger=n.a.getLogger("GeocodeFilterExtension"),this.logger.trace("[Constructeur GeocodeFilterExtension ()]"),!(this instanceof o))throw new TypeError("GeocodeFilterExtension constructor cannot be called as a function.");this.filters=[]}var n=r(0);o.prototype={constructor:o,addFilterExtensions:function(e){e&&this.filters.push(e)},getNames:function(){var e=[];for(var t in this.filters)e.push(this.filters[t].CLASSNAME);return this.logger.trace(e),e},getFilter:function(e){var t=null;for(var r in this.filters)this.filters[r].CLASSNAME===e&&(t=this.filters[r]);return this.logger.trace(t),t},getFilters:function(){return this.logger.trace(this.filters),this.filters},getAttributs:function(e){var t=[];for(var r in this.filters)this.filters[r].CLASSNAME===e&&(t=this.filters[r].attributesList);return this.logger.trace(t),t},setPlaceAttributs:function(e,t){var r=this.getFilter(e),o=this.getAttributs(e);for(var n in o){var s=o[n];t[s]&&(r.placeAttributes[s]=t[s])}},getPlaceAttributs:function(e){var t={};for(var r in this.filters)this.filters[r].CLASSNAME===e&&(t=this.filters[r].placeAttributes);return this.logger.trace(t),t}},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position={x:null,y:null},this.matchType=null,this.placeAttributes={},this.type=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(4),s=r(50),i=r.n(s),a={call:function(e){var t=o.a.getLogger("XHR");if(t.trace("[XHR::call()]"),i.a.polyfill(),!e.url)throw new Error("missing parameter : url is not defined !");if(!e.method)throw new Error("missing parameter : method is not defined !");e.format||(e.format="text");var r={};switch(r.url=e.url,r.data=e.data?e.data:null,r.method=e.method,r.timeOut=e.timeOut||0,r.scope=e.scope||this,r.proxy=e.proxy||null,r.content=e.content||null,r.headers=e.headers||{referer:"http://localhost"},e.method){case"DELETE":case"GET":break;case"PUT":case"POST":r.content=e.content?e.content:"application/x-www-form-urlencoded",r.headers=e.headers?e.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(e.format){case"text":this.__call(r).then(function(r){t.trace(r),e.onResponse.call(this,r)}).catch(function(t){e.onFailure.call(this,t)});break;case"json":this.__callJSON(r).then(function(r){t.trace(r),e.onResponse.call(this,r)}).catch(function(t){e.onFailure.call(this,t)});break;case"xml":this.__callXML(r).then(function(r){t.trace(r),e.onResponse.call(this,r)}).catch(function(t){e.onFailure.call(this,t)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(e){var t=o.a.getLogger("XHR");return t.trace("[XHR::__call()]"),new Promise(function(o,s){var i="POST"===e.method||"PUT"===e.method?1:0;e.data&&("object"==typeof e.data&&Object.keys(e.data).length||"string"==typeof e.data&&e.data.length)&&!i&&(e.url=n.a.normalyzeUrl(e.url,e.data)),t.trace("URL = ",e.url);var a=null;if("undefined"==typeof window){var l=r(53);e.data&&"string"==typeof e.data&&i&&(e.body=e.data),e.rejectUnauthorized=!1,l(e,function(e,t,r){!e&&200===t.statusCode&&r?o(r):s("Errors Occured on Http Request (nodejs) : "+e)})}else if(window.XMLHttpRequest){t.trace("XMLHttpRequest"),a=new XMLHttpRequest,a.open(e.method,e.url,!0),a.overrideMimeType=e.content;var c=null;e.timeOut>0&&(t.trace("XHR - TimeOut actif !"),c=window.setTimeout(function(){s({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})},e.timeOut)),i&&(t.trace("data = ",e.data),a.setRequestHeader("Content-type",e.content)),a.onerror=function(e){console.log(e),s(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(e){console.log(e),s(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onreadystatechange=function(e){if(4===a.readyState)if(200===a.status)window.clearTimeout(c),o(a.response);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"')",r=e.target.status;s({message:t,status:r})}};var u=e.data&&i?e.data:null;a.send(u)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");t.trace("XDomainRequest"),a=new XDomainRequest,a.open(e.method,e.url),a.overrideMimeType=e.content,e.timeOut>0&&(a.timeout=e.timeout,t.trace("XHR - TimeOut actif !")),i&&a.setRequestHeader("Content-type",e.content),a.onerror=function(){s(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(){s(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onload=function(e){if(200===a.status)o(a.responseText);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"')",r=e.target.status;s({message:t,status:r})}};var p=e.data&&i?e.data:null;a.send(p)}})},__callJSON:function(e){return this.__call(e).then(JSON.parse).catch(function(t){console.log("_callJSON failed on : ",e.url,t)})},__callXML:function(e){return this.__call(e).then(function(e){var t;if("undefined"==typeof window){t=(new(0,r(20).DOMParser)).parseFromString(e,"text/xml")}else if(window.DOMParser){var o=new window.DOMParser;t=o.parseFromString(e,"text/xml")}else t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e);return t}).catch(function(t){console.log("__callXML failed on : ",e.url,t)})}};t.a=a},function(t,r){t.exports=e},function(e,t){e.exports={name:"geoportal-access-lib",version:"2.1.5",date:"12/09/2019",description:"French Geoportal resources access library",module:"src/Gp.js",main:"dist/GpServices-src.js",homepage:"https://github.com/IGNF/geoportal-access-lib#readme",scripts:{clean:'echo "Warning: no yet implemented!" && exit 0',setup:"npm install",cover:"nyc --reporter=lcov --reporter=text npm run test",build:"webpack","build:prod":"webpack --env.production","build:dev":"webpack --env.development",test:'mocha-webpack --webpack-config webpack.test.js --glob "test_*.js" test/spec/',"test:serve":"webpack-dev-server --hot --config webpack.test.serve.js","test:end-to-end:serve":"webpack-dev-server --hot --config webpack.end-to-end.serve.js",sample:"npm run sample:serve","sample:serve":"webpack-dev-server --open-page samples/index-src.html --https --content-base .  --output-public-path '/dist/' --port 9001 --open 'google-chrome'","sample:serve:prod":"webpack-dev-server --env.production --open-page samples/index.html --content-base . --output-public-path '/dist/' --port 9001 --open 'google-chrome","sample:serve:dev":"webpack-dev-server --env.development --open-page samples/index-map.html --content-base . --output-public-path '/dist/' --port 9001 --open 'google-chrome",doc:"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open"},nyc:{include:["src/**/*.js"],instrument:!1,sourceMap:!1},repository:{type:"git",url:"https://github.com/IGNF/geoportal-access-lib.git"},keywords:["geoportail","webservice","javascript","es6"],author:"IGNF",license:"CECILL-B",dependencies:{"es6-promise":"^4.2.4",request:"^2.87.0",xmldom:"^0.1.27"},devDependencies:{"babel-core":"^6.26.3","babel-loader":"^7.1.2","babel-preset-env":"^1.7.0",chai:"^4.1.2","clean-webpack-plugin":"^0.1.18","copy-webpack-plugin":"^4.5.1",eslint:"^4.18.2","eslint-config-standard":"^11.0.0","eslint-loader":"^2.0.0","eslint-plugin-import":"^2.9.0","eslint-plugin-node":"^6.0.1","eslint-plugin-promise":"^3.7.0","eslint-plugin-standard":"^3.0.1",glob:"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^2.30.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"0.0.1",loglevel:"^1.6.1",mocha:"^4.0.0","mocha-loader":"^1.1.3","mocha-webpack":"^1.0.1",nyc:"^12.0.2",path:"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0",sinon:"^4.3.0","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.2.2","string-template":"^1.0.0",webpack:"^3.11.0","webpack-dev-server":"^2.11.3","webpack-node-externals":"^1.6.0","webpack-shell-plugin":"^0.5.0"},bundledDependencies:[],peerDependencies:{},optionalDependencies:{}}},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",s.a.apply(this,arguments),this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}var n=r(0),s=r(23);o.prototype=Object.create(s.a.prototype,{zonly:{get:function(){return this._zonly},set:function(e){this._zonly=e}}}),o.prototype.constructor=o,o.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"zonly",v:this.zonly}),e.push({k:"format",v:this.format}),e},t.a=o},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=e||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}var n=r(0);o.CLASSNAME="AltiRequest",o.prototype={constructor:o,setPositions:function(e){for(var t=[],r=0;r<e.length;r++){var o=e[r];o.lon&&o.lat&&t.push(o)}this.positions=t},getPositions:function(e){if(!e)return this.positions;var t=this.positions.length-1;return e>t||e<t?(this.logger.warn("index out of range !"),this.positions):this.positions[e]},addPositions:function(e){for(var t=0;t<e.length;t++){var r=e[t];r.lon&&r.lat&&this.positions.push(e[t])}},getLon:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t].lon);return this.logger.trace(e),e.join(this.delimiter)},getLat:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t].lat);return this.logger.trace(e),e.join(this.delimiter)}},o.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"delimiter",v:this.delimiter}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"format",v:this.format}),e},t.a=o},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",s.a.apply(this,arguments),this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}var n=r(0),s=r(23);o.prototype=Object.create(s.a.prototype,{sampling:{get:function(){return this._sampling},set:function(e){this._sampling=e}}}),o.prototype.constructor=o,o.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"sampling",v:this.sampling}),e.push({k:"format",v:this.format}),e},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}o.prototype={constructor:o,isConfLoaded:function(e){if(e)return!!this.generalOptions.apiKeys[e]},getLayersId:function(e){return this.generalOptions.apiKeys[e]},getLayersConf:function(e){var t={},r=this.getLayersId(e);if(r)for(var o=0;o<r.length;o++){var n=r[o];t[n]=this.layers[n]}return t},getLayerConf:function(e){if(this.layers)return this.layers[e]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(e){if(this.tileMatrixSets)return this.tileMatrixSets[e]},getTerritories:function(){return this.territories},getTerritoryConf:function(e){if(this.territories)return this.territories[e]},getServices:function(){return this.services},getServiceConf:function(e){if(this.services)return this.services[e]}},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Layer constructor cannot be called as a function.")}o.prototype={constructor:o,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var e=[];return e.push(this.defaultProjection),e.concat(this.additionalProjections)},getBBOX:function(){if(this.globalConstraint)return this.globalConstraint.bbox},getMinScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.minScaleDenominator},getMaxScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.maxScaleDenominator},getTMSID:function(){if(this.wmtsOptions)return this.wmtsOptions.tileMatrixSetLink},getServiceParams:function(){return this.serviceParams},getServerUrl:function(e){if(e&&this.serviceParams&&this.serviceParams.serverUrl)return this.serviceParams.serverUrl[e]},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){if(this.styles){for(var e,t=this.styles,r=0;r<t.length;r++)if(!0===t[r].current){e=t[r].name;break}return e}},getThematics:function(){return this.thematics},getDefaultFormat:function(){if(this.formats){for(var e,t=this.formats,r=0;r<t.length;r++)if(!0===t[r].current){e=t[r].name;break}return e}},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){if(this.isAggregate)return this.aggregatedLayers}},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null,this.url=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}o.prototype={constructor:o,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var e,t=this.getTileMatrices();if(t)for(var r in t)if(t.hasOwnProperty(r)){e=t[r].topLeftCorner;break}return e}},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}o.prototype={constructor:o,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur LocationUtilityService ()]"),!(this instanceof o))throw new TypeError("LocationUtilityService constructor cannot be called as a function.");this.CLASSNAME="LocationUtilityService",this.CLASSTYPE=null,s.a.apply(this,arguments),this.options&&(this.CLASSTYPE=this.options.location?"GeocodeRequest":this.options.position?"ReverseGeocodeRequest":null)}var n=r(0),s=r(12),i=r(68),a=r(70),l=r(13);o.prototype=Object.create(s.a.prototype,{}),o.prototype.constructor=o,o.prototype.addRequest=function(e){switch(this.CLASSTYPE=e.CLASSNAME,this.CLASSTYPE){case"GeocodeRequest":case"ReverseGeocodeRequest":this.oRequest=e;break;default:throw new Error("Ce n'est pas un objet de type 'LUS Request' !?")}},o.prototype.addFilter=function(e){e instanceof l.a&&(this.oFilter=e)},o.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("GeocodeRequest"===this.CLASSTYPE){var e={location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new i.a(e),this.oFilter&&this.oRequest.addFilter(this.oFilter)}else if("ReverseGeocodeRequest"===this.CLASSTYPE){var t={position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new a.a(t)}else this.logger.error("impossible de determiner le type de geocodage : Direct ou Inverse !?")}if(!this.oRequest)throw new Error("Type de Geocodage indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("DirectGeocodedLocation constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="DirectGeocodedLocation",this.accuracy=null}var n=r(15);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("ReverseGeocodedLocation constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="ReverseGeocodedLocation",this.searchCenterDistance=null}var n=r(15);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}o.prototype={constructor:o},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}o.prototype={constructor:o},t.a=o},function(e,t,r){e.exports=r(45)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(46),n=r(5),s=r(9),i=r(10),a=r(42),l=r(43),c=r(25),u=r(26),p=r(27),h=r(28),f=r(29),g=r(30),d=r(31),m=r(32),E=r(33),_=r(34),v=r(35),y=r(37),R=r(38),S=r(36),w=r(14),A=r(15),b=r(40),P=r(41),T=r(18),O=r(16),x=r(17),C=r(19),N=r(2),I=r(4),M=r(21),L=r.n(M);const D=L.a.version;t.servicesVersion=D;const F=L.a.date;t.servicesDate=F;var U={};U.servicesVersion=D,U.servicesDate=F,U.Protocols={},U.Protocols.XHR=C.a,U.Services=o.a,U.Services.DefaultUrl=n.a,U.Services.AltiResponse=s.a,U.Services.Alti={},U.Services.Alti.Elevation=i.a,U.Services.AutoCompleteResponse=a.a,U.Services.AutoComplete={},U.Services.AutoComplete.SuggestedLocation=l.a,U.Services.GetConfigResponse=c.a,U.Services.Config={},U.Services.Config.Constraint=u.a,U.Services.Config.Format=p.a,U.Services.Config.Layer=h.a,U.Services.Config.Legend=f.a,U.Services.Config.Metadata=g.a,U.Services.Config.Originator=d.a,U.Services.Config.Service=m.a,U.Services.Config.Style=E.a,U.Services.Config.Territory=_.a,U.Services.Config.Thematic=v.a,U.Services.Config.TileMatrix=y.a,U.Services.Config.TileMatrixLimit=R.a,U.Services.Config.TileMatrixSet=S.a,U.Services.GeocodeResponse=w.a,U.Services.Geocode={},U.Services.Geocode.GeocodedLocation=A.a,U.Services.Geocode.DirectGeocodedLocation=b.a,U.Services.Geocode.ReverseGeocodedLocation=P.a,U.Services.IsoCurveResponse=T.a,U.Services.RouteResponse=O.a,U.Services.Route={},U.Services.Route.RouteInstruction=x.a,U.Error=N.a,U.Helper=I.a,t.default=U},function(e,t,r){"use strict";var o=r(47),n=r(61),s=r(64),i=r(79),a=r(83),l=r(85),c=r(97),u={getConfig:function(e){new n.a(e).call()},getAltitude:function(e){new o.a(e).call()},geocode:function(e){new s.a(e).call()},reverseGeocode:function(e){new i.a(e).call()},autoComplete:function(e){new a.a(e).call()},route:function(e){new l.a(e).call()},isoCurve:function(e){new c.a(e).call()}};t.a=u},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!e.positions)throw new Error(s.a.getMessage("PARAM_MISSING","positions"));if(0===e.positions.length)throw new Error(s.a.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=e.positions,this.options.outputFormat="string"==typeof e.outputFormat?e.outputFormat.toLowerCase():"xml",this.options.sampling=e.sampling||null,this.options.api="string"==typeof e.api?e.api.toUpperCase():"REST","REST"===this.options.api&&(this.options.httpMethod="GET"),this.options.zonly=e.zonly||!1,!this.options.serverUrl){var t=l.a.Alti.url(this.options.apiKey),r=null;switch(this.options.api){case"WPS":r=t.wps;break;case"REST":r=t[(e.sampling?"profil":"elevation")+"-"+this.options.outputFormat];break;default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","api"))}if(!r)throw new Error("Url by default not found !");this.options.serverUrl=r,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var c=this.options.serverUrl.substring(i+1);if(c&&c.length<5)switch(this.logger.trace("Server Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(5),c=r(55),u=r(59);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){var r={httpMethod:this.options.httpMethod,onSuccess:function(e){this.request=e,t.call(this,this.request)},onError:e,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};c.a.build(r)},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};u.a.build(r)}else e.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},t.a=o},function(e,t,r){var o,n;!function(s,i){"use strict";o=i,void 0!==(n="function"==typeof o?o.call(t,r,t,e):o)&&(e.exports=n)}(0,function(){"use strict";function e(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function t(t){return"debug"===t&&(t="log"),typeof console!==a&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):i)}function r(e,t){for(var r=0;r<l.length;r++){var o=l[r];this[o]=r<e?i:this.methodFactory(o,e,t)}this.log=this.debug}function o(e,t,o){return function(){typeof console!==a&&(r.call(this,t,o),this[e].apply(this,arguments))}}function n(e,r,n){return t(e)||o.apply(this,arguments)}function s(e,t,o){function s(e){var t=(l[e]||"silent").toUpperCase();if(typeof window!==a){try{return void(window.localStorage[p]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(p)+"="+t+";"}catch(e){}}}function i(){var e;if(typeof window!==a){try{e=window.localStorage[p]}catch(e){}if(typeof e===a)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(p)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}var c,u=this,p="loglevel";e&&(p+=":"+e),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=o||n,u.getLevel=function(){return c},u.setLevel=function(t,o){if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(c=t,!1!==o&&s(t),r.call(u,t,e),typeof console===a&&t<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){i()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var h=i();null==h&&(h=null==t?"WARN":t),u.setLevel(h,!1)}var i=function(){},a="undefined",l=["trace","debug","info","warn","error"],c=new s,u={};c.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new s(e,c.getLevel(),c.methodFactory)),t};var p=typeof window!==a?window.log:void 0;return c.noConflict=function(){return typeof window!==a&&window.log===c&&(window.log=p),c},c.getLoggers=function(){return u},c})},function(e,t,r){"use strict";var o=r(4),n=r(19),s=r(54),i={send:function(e){var t=e||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"==typeof window&&"JSONP"===e.protocol)return void console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS");if("XHR"===e.protocol||"json"===e.format?t.wrap=!1:"JSONP"===e.protocol&&"xml"===e.format&&(t.wrap=!0),t.callback=(e.protocol,null),t.output=t.wrap?"json":null,t.wrap){var r={};r.output=t.output,r.callback=t.callback,delete r.callback,t.url=o.a.normalyzeUrl(e.url,r)}switch(t.protocol){case"XHR":"GET"===e.method&&e.nocache&&(t.url=o.a.normalyzeUrl(t.url,{t:(new Date).getTime()})),n.a.call(t);break;case"JSONP":t.data&&(t.url=o.a.normalyzeUrl(t.url,t.data)),s.a.call(t);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}};t.a=i},function(e,t,r){(function(t,r){!function(t,r){e.exports=r()}(0,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function o(e){return"function"==typeof e}function n(e){q=e}function s(e){G=e}function i(){return void 0!==k?function(){k(l)}:a()}function a(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<U;e+=2){(0,B[e])(B[e+1]),B[e]=void 0,B[e+1]=void 0}U=0}function c(e,t){var r=this,o=new this.constructor(p);void 0===o[K]&&T(o);var n=r._state;if(n){var s=arguments[n-1];G(function(){return A(n,o,s,r._result)})}else S(r,o,e,t);return o}function u(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(p);return _(r,e),r}function p(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function g(e,t,r,o){try{e.call(t,r,o)}catch(e){return e}}function d(e,t,r){G(function(e){var o=!1,n=g(r,t,function(r){o||(o=!0,t!==r?_(e,r):y(e,r))},function(t){o||(o=!0,R(e,t))},"Settle: "+(e._label||" unknown promise"));!o&&n&&(o=!0,R(e,n))},e)}function m(e,t){t._state===J?y(e,t._result):t._state===Q?R(e,t._result):S(t,void 0,function(t){return _(e,t)},function(t){return R(e,t)})}function E(e,t,r){t.constructor===e.constructor&&r===c&&t.constructor.resolve===u?m(e,t):void 0===r?y(e,t):o(r)?d(e,t,r):y(e,t)}function _(t,r){if(t===r)R(t,h());else if(e(r)){var o=void 0;try{o=r.then}catch(e){return void R(t,e)}E(t,r,o)}else y(t,r)}function v(e){e._onerror&&e._onerror(e._result),w(e)}function y(e,t){e._state===W&&(e._result=t,e._state=J,0!==e._subscribers.length&&G(w,e))}function R(e,t){e._state===W&&(e._state=Q,e._result=t,G(v,e))}function S(e,t,r,o){var n=e._subscribers,s=n.length;e._onerror=null,n[s]=t,n[s+J]=r,n[s+Q]=o,0===s&&e._state&&G(w,e)}function w(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var o=void 0,n=void 0,s=e._result,i=0;i<t.length;i+=3)o=t[i],n=t[i+r],o?A(r,o,n,s):n(s);e._subscribers.length=0}}function A(e,t,r,n){var s=o(r),i=void 0,a=void 0,l=!0;if(s){try{i=r(n)}catch(e){l=!1,a=e}if(t===i)return void R(t,f())}else i=n;t._state!==W||(s&&l?_(t,i):!1===l?R(t,a):e===J?y(t,i):e===Q&&R(t,i))}function b(e,t){try{t(function(t){_(e,t)},function(t){R(e,t)})}catch(t){R(e,t)}}function P(){return $++}function T(e){e[K]=$++,e._state=void 0,e._result=void 0,e._subscribers=[]}function O(){return new Error("Array Methods must be provided an Array")}function x(e){return new Z(this,e).promise}function C(e){var t=this;return new t(F(e)?function(r,o){for(var n=e.length,s=0;s<n;s++)t.resolve(e[s]).then(r,o)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function N(e){var t=this,r=new t(p);return R(r,e),r}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var o=null;try{o=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===o&&!t.cast)return}e.Promise=ee}var D=void 0;D=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var F=D,U=0,k=void 0,q=void 0,G=function(e,t){B[U]=e,B[U+1]=t,2===(U+=2)&&(q?q(l):z())},V="undefined"!=typeof window?window:void 0,j=V||{},X=j.MutationObserver||j.WebKitMutationObserver,Y="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),H="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,B=new Array(1e3),z=void 0;z=Y?function(){return function(){return t.nextTick(l)}}():X?function(){var e=0,t=new X(l),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():H?function(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}():void 0===V?function(){try{var e=Function("return this")().require("vertx");return k=e.runOnLoop||e.runOnContext,i()}catch(e){return a()}}():a();var K=Math.random().toString(36).substring(2),W=void 0,J=1,Q=2,$=0,Z=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(p),this.promise[K]||T(this.promise),F(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?y(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&y(this.promise,this._result))):R(this.promise,O())}return e.prototype._enumerate=function(e){for(var t=0;this._state===W&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,o=r.resolve;if(o===u){var n=void 0,s=void 0,i=!1;try{n=e.then}catch(e){i=!0,s=e}if(n===c&&e._state!==W)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(r===ee){var a=new r(p);i?R(a,s):E(a,e,n),this._willSettleAt(a,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(o(e),t)},e.prototype._settledAt=function(e,t,r){var o=this.promise;o._state===W&&(this._remaining--,e===Q?R(o,r):this._result[t]=r),0===this._remaining&&y(o,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;S(e,void 0,function(e){return r._settledAt(J,t,e)},function(e){return r._settledAt(Q,t,e)})},e}(),ee=function(){function e(t){this[K]=P(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&I(),this instanceof e?b(this,t):M())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,r=t.constructor;return o(e)?t.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return ee.prototype.then=c,ee.all=x,ee.race=C,ee.resolve=u,ee.reject=N,ee._setScheduler=n,ee._setAsap=s,ee._asap=G,ee.polyfill=L,ee.Promise=ee,ee})}).call(t,r(51),r(52))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function n(e){if(u===setTimeout)return setTimeout(e,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function s(e){if(p===clearTimeout)return clearTimeout(e);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function i(){d&&f&&(d=!1,f.length?g=f.concat(g):m=-1,g.length&&a())}function a(){if(!d){var e=n(i);d=!0;for(var t=g.length;t;){for(f=g,g=[];++m<t;)f&&f[m].run();m=-1,t=g.length}f=null,d=!1,s(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var u,p,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(e){u=r}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(e){p=o}}();var f,g=[],d=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];g.push(new l(e,t)),1!==g.length||d||n(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.prependListener=c,h.prependOnceListener=c,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,r){e.exports=t},function(e,t,r){"use strict";var o=r(0),n={uuid:function(){var e=Math.floor(Date.now());return function(){return e++}}(),call:function(e){var t=o.a.getLogger("JSONP");if(t.trace("[JSONP::call ()]"),!e)throw t.error("missing parameter : options !"),new Error("missing parameter : options !");if(!e.url)throw t.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(e.timeOut||(t.info("setting 'options.timeOut' default value"),e.timeOut=0),!e.onResponse)throw t.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var r="string"==typeof e.callbackSuffix?e.callbackSuffix:this.uuid(),n=!1,s=!1,i=e.url.indexOf("callback=");if(-1!==i){n=!0;var a=e.url.indexOf("&",i);-1===a&&(a=e.url.length);var l=e.url.substring(i+9,a);l&&(s=!0,e.callbackName=l,t.info("setting 'options.callbackName' value ("+e.callbackName+") from 'options.url' parameter"))}if(!n){var c=e.url.indexOf("?");-1===c?e.url=e.url+"?callback=":c===e.url.length?e.url=e.url+"callback=":e.url=e.url+"&callback=",t.info("setting callback default key in 'options.url' : "+e.url)}var u=!!e.callbackName||s;if(s||(e.callbackName||(t.info("setting 'options.callbackName' default value"),e.callbackName="callback",(r||""===r)&&(e.callbackName+=r)),e.url=e.url.replace("callback=","callback="+e.callbackName),t.info("setting callback function name in 'options.url' : "+e.url)),e.onTimeOut||(t.info("setting 'options.onTimeOut' default value"),e.onTimeOut=function(){console.log("TimeOut while invoking url : "+e.url)}),!u){var p=this,h=null;e.timeOut>0&&(h=window.setTimeout(function(){window[e.callbackName]=function(){},e.onTimeOut(),p._deleteScript(r)},e.timeOut)),window[e.callbackName]=function(t){window.clearTimeout(h),e.onResponse(t),p._deleteScript(r)}}this._createScript(r,e.url)},_createScript:function(e,t){var r,o=document.getElementById("results"+e);r=document.createElement("script"),r.setAttribute("type","text/javascript"),r.setAttribute("src",t),r.setAttribute("charset","UTF-8"),r.setAttribute("id","results"+e),r.setAttribute("async","true");var n=document.documentElement||document.getElementsByTagName("head")[0];null===o?n.appendChild(r):n.replaceChild(r,o)},_deleteScript:function(e){var t=document.getElementById("results"+e);if(t){var r=t.parentNode||document.documentElement;if(!r)return;r.removeChild(t)}}};t.a=n},function(e,t,r){"use strict";var o=r(0),n=r(2),s=r(56),i=r(57),a={build:function(e){o.a.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var t=null,r={type:e.sampling?"Profil":"Elevation",method:e.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};r.param.positions=e.positions,r.param.format=e.outputFormat,r.param.sampling=e.sampling,r.param.zonly=e.zonly;var a=!(null===e.onError||"function"!=typeof e.onError),l=!(null===e.onSuccess||"function"!=typeof e.onSuccess),c=null;switch(e.api){case"REST":var u=new s.a(r);if(!u.processRequestString()){if(c="Error in process request (rest) !",a)return void e.onError.call(e.scope,new n.a(c));throw new Error(c)}t=u.requestString;break;case"WPS":if(r.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(t=i.a.build(r))){if(c="Error in process request (wps) !",a)return void e.onError.call(e.scope,new n.a(c));throw new Error(c)}break;default:if(c="Type of API is not supported by service (REST or WPS) !",a)return void e.onError.call(e.scope,new n.a(c));throw new Error(c)}return l&&e.onSuccess.call(e.scope,t),t}};t.a=a},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof o))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=e||{},!this.options)throw new Error(s.a.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(s.a.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new i.a(this.options.param);break;case"Profil":this.DataObject=new a.a(this.options.param);break;default:throw new Error(s.a.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}var n=r(0),s=r(1),i=r(22),a=r(24);o.prototype={requestString:null,constructor:o,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:"lon=__LON__\nlat=__LAT__\nindent=__INDENT__\ncrs='__CRS__'\n",input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var e="";return"POST"===this.method?e=this.template.post.value:"GET"===this.method&&(e=this.template.get.value),e=e.replace(/__LON__/g,this.DataObject.getLon()),e=e.replace(/__LAT__/g,this.DataObject.getLat()),e=e.replace(/__INDENT__/g,this.DataObject.indent),e=e.replace(/__CRS__/g,this.DataObject.crs),e+=this.__addDataInputs(),this.logger.trace("traduction tmpl",e),this.requestString=e,this.requestString},__addDataInputs:function(){this.logger.trace("AltiRequestREST::addDataInput ()");var e;if("POST"===this.method)e=this.template.post;else{if("GET"!==this.method)throw new Error("No other HTTP method supported by the service !");e=this.template.get}var t=null;if("AltiElevationRequest"===this.DataObject.CLASSNAME)return t=e.input.point,t.replace(/__ZONLY__/g,this.DataObject.zonly);if("AltiProfilRequest"===this.DataObject.CLASSNAME)return t=e.input.profil,t.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(1),s=r(58),i=r(22),a=r(24),l={build:function(e){if(o.a.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!e)throw new Error(n.a.getMessage("PARAM_EMPTY","options"));if(!e.type)throw new Error(n.a.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var t=null;switch(e.type){case"Elevation":e.wps.identifier="gs:WPSElevation",t=new i.a(e.param);break;case"Profil":e.wps.identifier="gs:WPSLineElevation",t=new a.a(e.param);break;default:throw new Error(n.a.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var r={data:t,method:e.method,param:e.wps},l=new s.a(r);if(!l.processRequestString())throw new Error("Enable to process request !");return l.requestString}};t.a=l},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof o))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=e||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}var n=r(0);o.prototype={requestString:null,constructor:o,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=\x3c!-- __DATAINPUTS__ --\x3e",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs>\x3c!-- __DATAINPUTS__ --\x3e</wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var e="";if("POST"===this.method)e=this.template.post.value;else{if("GET"!==this.method)return this.logger.error("No other method supported by the service !"),!1;e=this.template.get.value}return e=e.replace(/__SERVICE__/g,this.paramservice),e=e.replace(/__VERSION__/g,this.paramversion),e=e.replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput),e=e.replace(/__IDENTIFIER__/g,this.paramidentifier),e=e.replace(/__REQUEST__/g,this.paramrequest),"POST"===this.method&&(e=e.replace(/__NAMESPACE__/g,this.namespaceByDefault),e=e.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(e=e.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=e,this.logger.trace("traduction tmpl",e),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var e="GET"===this.method?this.template.get.input:this.template.post.input,t="GET"===this.method?";":"",r="",o=this,n=this.DataObject.getData(),s=0;s<n.length;s++)!function(s){t&&(t=s===n.length-1?"":";"),r=r.concat(o.__addDataInput(e,n[s].k,n[s].v),t)}(s);return r},__addDataInput:function(e,t,r){var o=e;return o=o.replace(/__KEY__/g,t),o=o.replace(/__DATA__/g,r)},setMethod:function(e){"GET"===e||"POST"===e?this.method=e:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(60),l=r(9),c=r(10),u={build:function(e){var t=o.a.getLogger("AltiResponseFactory");t.trace(["AltiResponseFactory::build()"]);var r=null;if(!e.response)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(e.rawResponse)t.trace("analyze response : raw"),r=e.response;else{switch(e.outputFormat){case"xml":t.trace("analyze response : xml");try{var u=new i.a({reader:a.a});if("string"==typeof e.response?u.setXMLString(e.response):u.setXMLDoc(e.response),!(r=u.parse()))throw new Error(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(t){var p=t.message;return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",p),status:200,type:s.a.TYPE_SRVERR}))}break;case"json":t.trace("analyze response : json"),t.trace("analyze response : ",typeof e.response);var h;if(h="string"==typeof e.response?JSON.parse(e.response):e.response,h.error)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",h.error.description),status:200,type:s.a.TYPE_SRVERR}));if(h){var f,g=h.elevations,d=new l.a;if(Array.isArray(g)&&g.length)for(var m=0;m<g.length;m++)f=new c.a,"object"==typeof g[m]?(g[m].lon&&(f.lon=g[m].lon),g[m].lat&&(f.lat=g[m].lat),g[m].z&&(f.z=g[m].z),g[m].acc&&(f.acc=g[m].acc)):"number"==typeof g[m]&&(f.z=g[m]),Array.isArray(d.elevations)&&d.elevations.push(f);r=d}if(!r)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:s.a.TYPE_UNKERR,status:-1}));break;default:return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:s.a.TYPE_UNKERR,status:-1}))}if(r.exceptionReport)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",r.exceptionReport),type:s.a.TYPE_SRVERR,status:200}));if(r.error){var E=r.error.description;return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",E),type:s.a.TYPE_SRVERR,status:200}))}}e.onSuccess.call(e.scope,r)}};t.a=u},function(e,t,r){"use strict";var o=r(9),n=r(10),s={};s.READERS={elevations:function(e){var t=new o.a;if(e.hasChildNodes())for(var r,n,i=e.childNodes,a=0;a<i.length;a++)r=i[a],s.READERS[r.nodeName]&&(n=s.READERS[r.nodeName](r),t.elevations.push(n));return t},elevation:function(e){var t=new n.a;if(e.hasChildNodes())for(var r,o=e.childNodes,i=0;i<o.length;i++)r=o[i],s.READERS[r.nodeName]&&s.READERS[r.nodeName](r,t);return t},lat:function(e,t){var r=e.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");t.lat=parseFloat(r.nodeValue)},lon:function(e,t){var r=e.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");t.lon=parseFloat(r.nodeValue)},z:function(e,t){var r=e.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!t)return t=new n.a,t.z=parseFloat(r.nodeValue),t;t.z=parseFloat(r.nodeValue)},acc:function(e,t){var r=e.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");t.acc=parseFloat(r.nodeValue)},exceptionreport:function(e){var t={};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(t.exceptionReport=s.READERS.exception(r));return t},exception:function(e){var t={},r=e.getAttribute("exceptionCode");r&&(t.exceptionCode=r);var o=e.firstChild;return o&&3===o.nodeType&&(t.exception=o.nodeValue),t},error:function(e){var t={error:{}};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++){r=o[n];var s;1===r.nodeType&&"code"===r.nodeName&&(s=r.firstChild)&&3===s.nodeType&&(t.error.code=s.nodeValue),1===r.nodeType&&"description"===r.nodeName&&(s=r.firstChild)&&3===s.nodeType&&(t.error.description=s.nodeValue)}return t}},s.read=function(e){if("elevations"===e.nodeName){return s.READERS.elevations(e)}if("ExceptionReport"===e.nodeName){return s.READERS.exceptionreport(e)}if("error"===e.nodeName){return s.READERS.error(e)}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},t.a=s},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",e||(e={}),e.protocol=e.protocol||"JSONP",c.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf (options)]"),!this.options.serverUrl&&!this.options.serverUrl){var t=l.a.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=t.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=t.apiKeys:this.options.serverUrl=t.apiKey}"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"xml"}var n=r(0),s=r(1),i=r(4),a=r(2),l=r(5),c=r(3),u=r(62);o.prototype=Object.create(c.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){var r="undefined"!=typeof window?window:{};if(r.Gp&&r.Gp.Config&&r.Gp.Config.generalOptions&&r.Gp.Config.layers&&r.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe déjà pour cette clé"),void this.options.onSuccess.call(this,r.Gp.Config);if(r.Gp.Config.layers[this.options.layerId]&&r.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe déjà pour cette clé et cette couche"),void this.options.onSuccess.call(this,r.Gp.Config)}this.request="";var o;o=-1===this.options.serverUrl.indexOf("http://"),!o&&this.layerId&&(this.request=i.a.normalyzeParameters({layerId:this.layerId})),this.request||""===this.request?t.call(this,this.request):e.call(this,new a.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};u.a.build(r)}else e.call(this,new a.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(63),l={build:function(e){o.a.getLogger("AutoConfResponseFactory").trace(["AutoConfResponseFactory::build()"]);var t=null;if(!e.response)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(e.rawResponse)t=e.response;else{try{var r=new i.a({reader:a.a});"string"==typeof e.response?r.setXMLString(e.response):r.setXMLDoc(e.response),t=r.parse()}catch(t){var l=t.message;return"string"==typeof e.response?l+="\n (raw response service'"+e.response+"')":l+="\n (raw response service'"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",l),status:200,type:s.a.TYPE_SRVERR}))}var c=!0;for(var u in t)t.hasOwnProperty(u)&&(c=!1);if(c)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(t.exceptionReport)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}var p="undefined"!=typeof window?window:{};p.Gp||(p.Gp={}),p.Gp.Config?this.mergeConfig(p.Gp.Config,t,e.layerId):p.Gp.Config=t,e.onSuccess.call(e.scope,p.Gp.Config)},mergeConfig:function(e,t,r){if(t&&e){for(var o in t)if(t.hasOwnProperty(o))if("generalOptions"===o)for(var n in t[o].apiKeys)t[o].apiKeys.hasOwnProperty(n)&&!e.generalOptions.apiKeys[n]&&(e.generalOptions.apiKeys[n]=t[o].apiKeys[n]);else if(e[o])for(var s in t[o])t[o].hasOwnProperty(s)&&!e[o][s]&&(e[o][s]=t[o][s]);if(r){var i=[];for(var a in t.layers)t.layers.hasOwnProperty(a)&&i.push(a);e.layers[r]&&(e.layers[r].aggregatedLayers=i)}}}};t.a=l},function(e,t,r){"use strict";function o(e){if(e.attributes.length>0){for(var t={},r=e.attributes,o=0;o<r.length;o++){var n=r[o];t[n.nodeName]=n.nodeValue}return t}}function n(e,t){if(e.hasChildNodes())for(var r,o,s,i=e.childNodes,a=0;a<i.length;a++)if(r=i[a],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,s=r.prefix||R.DEFAULTPREFIX,R.READERS[s][o]){var l=R.READERS[s][o];l(r,t)}else n(r,t)}function s(e){var t,r="";return e.hasChildNodes()&&(t=e.firstChild,3!==t.nodeType&&4!==t.nodeType||(r=t.nodeValue)),r}function i(e){if(e.attributes.length>0){var t=o(e);for(var r in t)if(t.hasOwnProperty(r)){if("version"===r&&t.version!==R.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if("xmlns"===r){if(t[r]!==R.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var n=r.split(":")[0],s=r.split(":")[1];if("xmlns"===n&&s&&R.NAMESPACES[s]&&R.NAMESPACES[s]!==t[r])return void console.log("[AutoConfResponseReader] autoconf response "+r+" namespace is not the expected one");if("schemaLocation"===s&&t[r]!==R.SCHEMALOCATION[0]&&t[r]!==R.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}}var a=r(25),l=r(26),c=r(27),u=r(28),p=r(29),h=r(30),f=r(31),g=r(32),d=r(33),m=r(34),E=r(35),_=r(36),v=r(37),y=r(38),R={};R.VERSION="1.1.0",R.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/1.1",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},R.SCHEMALOCATION=["http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf.xsd"],R.DEFAULTPREFIX="context",R.READERS={context:{ViewContext:function(e){i(e);var t=new a.a;return n(e,t),t},Title:function(e,t){t&&t.generalOptions?t.generalOptions.title=s(e):t&&t.lyr&&(t.lyr.title=s(e))},Abstract:function(e,t){t&&t.lyr&&(t.lyr.description=s(e))},Server:function(e,t){var r=e.getAttribute("service"),o=e.getAttribute("title"),s=e.getAttribute("version");if(r)if(t&&t.services&&"object"==typeof t.services&&!t.services[r]){var i=new g.a;i.title=o,i.version=s,n(e,i),t.services[r]=i}else t&&t.lyr&&(t.lyr.serviceParams||(t.lyr.serviceParams={}),t.lyr.serviceParams.id=r,t.lyr.serviceParams.version=s)},OnlineResource:function(e,t){t&&t.hasOwnProperty("serverUrl")&&(t.serverUrl=e.getAttribute("xlink:href"))},LayerList:function(e,t){if(n(e,t),t&&t.layers&&t.generalOptions&&t.services)for(var r in t.layers)if(t.layers.hasOwnProperty(r)){var o=t.layers[r],s=o.apiKeys;if(s&&Array.isArray(s))for(var i=0;i<s.length;i++){var a=s[i];t.generalOptions.apiKeys&&(t.generalOptions.apiKeys[a]&&Array.isArray(t.generalOptions.apiKeys[a])||(t.generalOptions.apiKeys[a]=[]),t.generalOptions.apiKeys[a].push(r))}var l=o.serviceParams;if(l&&l.id&&!t.services[l.id]){var c=new g.a;l.serverUrl&&(c.serverUrl=l.serverUrl),l.version&&(c.version=l.version),t.services[l.id]=c}if(o.wmtsOptions&&o.wmtsOptions.tileMatrixSetLink&&t.tileMatrixSets){var u=o.wmtsOptions.tileMatrixSetLink,p=t.tileMatrixSets;for(var h in p)p.hasOwnProperty(h)&&h===u&&(o.defaultProjection=p[h].projection)}}},Layer:function(e,t){if(t&&t.layers){var r={lyr:new u.a,lyrId:null},o=e.getAttribute("hidden");r.lyr.hidden="1"===o;var s=e.getAttribute("queryable");if(r.lyr.queryable="1"===s,n(e,r),r.lyrId){if(r.lyr.serviceParams&&r.lyr.serviceParams.id){var i=r.lyr.serviceParams.id;if(-1!==i.toUpperCase().indexOf("OPENLS")||-1!==i.toUpperCase().indexOf("ELEVATION")){var a=r.lyrId.split("$")[0];r.lyrId=a+"$"+i}}r.lyr.layerId=r.lyrId,t.layers[r.lyrId]=r.lyr}}},Name:function(e,t){t&&t.lyr&&(t.lyr.name=s(e))},SRS:function(e,t){t&&t.lyr&&(t.lyr.defaultProjection=s(e))},Format:function(e,t){if(t&&t.lyr){var r=new c.a,o=e.getAttribute("current");r.current="1"===o,r.name=s(e),t.lyr.formats&&Array.isArray(t.lyr.formats)||(t.lyr.formats=[]),t.lyr.formats.push(r)}},Style:function(e,t){if(t&&t.lyr){var r=new d.a,o=e.getAttribute("current");if(r.current="1"===o||1===o,e.hasChildNodes)for(var n,i,a=e.childNodes,l=0;l<a.length;l++)n=a[l],1===n.nodeType&&(i=n.localName||n.baseName||n.nodeName,"Name"===i?r.name=s(n):"Title"===i?r.title=s(n):"URL"===i&&(r.url=s(n)));t.lyr.styles&&Array.isArray(t.lyr.styles)||(t.lyr.styles=[]),t.lyr.styles.push(r)}},Dimension:function(e,t){var r=e.getAttribute("name"),o=s(e);t&&t.lyr&&(t.lyr.dimensions||(t.lyr.dimensions={}),"Type"===r?t.lyr.dimensions.type=o:"VisibilityRange"===r?t.lyr.dimensions.visibilityRange=o:"VisibilityMode "===r?t.lyr.dimensions.visibilityMode=o:"GeometricType"===r?t.lyr.dimensions.geometricType=o:"NoDataValue"===r&&(t.lyr.dimensions.noDataValue=o))}},gpp:{Theme:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("theme")&&(t.generalOptions.theme=s(e))},defaultGMLGFIStyleUrl:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(t.generalOptions.defaultGMLGFIStyle=s(e))},Territory:function(e,t){var r=e.getAttribute("id");if(r){var o=new m.a,s=e.getAttribute("default");o.isDefault="1"===s,n(e,o),t&&t.territories&&"object"==typeof t.territories&&(t.territories[r]=o)}},defaultCRS:function(e,t){t&&t.hasOwnProperty("defaultCRS")&&(t.defaultCRS=s(e))},AdditionalCRS:function(e,t){var r=s(e);r&&t&&(Array.isArray(t.additionalCRS)?t.additionalCRS.push(r):(t.additionalProjections&&Array.isArray(t.additionalProjections)||(t.additionalProjections=[]),t.additionalProjections.push(r)))},DefaultLayer:function(e,t){var r=e.getAttribute("layerId");r&&t&&Array.isArray(t.defaultLayers)&&t.defaultLayers.push(r)},BoundingBox:function(e,t){if(t){var r=s(e).split(",");if(4===r.length){var o={left:parseFloat(r[0]),right:parseFloat(r[2]),top:parseFloat(r[3]),bottom:parseFloat(r[1])},n=e.getAttribute("minT"),i=e.getAttribute("maxT");if(t.hasOwnProperty("geoBBOX"))t.geoBBOX=o;else if(t.hasOwnProperty("bbox"))if(t.bbox.left||t.bbox.right||t.bbox.top||t.bbox.bottom){t.multiConstraints||(t.multiConstraints=[]);var a=new l.a;a.bbox=o,a.temporalExtent=[n,i],t.multiConstraints.push(a)}else t.bbox=o,t.temporalExtent=[n,i];else t.globalConstraint||(t.globalConstraint=new l.a),t.globalConstraint.bbox=o,t.globalConstraint.temporalExtent=[n,i]}}},Resolution:function(e,t){var r=s(e);r&&t&&t.defaultOptions&&t.defaultOptions.hasOwnProperty("resolution")&&(t.defaultOptions.resolution=parseFloat(r))},x:function(e,t){var r=s(e);r&&t&&t.geoCenter&&t.geoCenter.hasOwnProperty("lon")&&(t.geoCenter.lon=parseFloat(r))},y:function(e,t){var r=s(e);r&&t&&t.geoCenter&&t.geoCenter.hasOwnProperty("lat")&&(t.geoCenter.lat=parseFloat(r))},Resolutions:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("wgs84Resolutions")&&(t.generalOptions.wgs84Resolutions=s(e).split(","))},Layer:function(e,t){if(t&&t.hasOwnProperty("lyrId")&&t.lyr){t.lyrId=e.getAttribute("id");var r=e.getAttribute("aggregate"),o=e.getAttribute("more");(r||o)&&(t.lyr.isAggregate=!0),n(e,t.lyr)}},Constraint:function(e,t){var r=new l.a;if(n(e,r),t)if(t.constraints&&Array.isArray(t.constraints)||(t.constraints=[]),r.multiConstraints&&Array.isArray(r.multiConstraints)){var o=new l.a;o.crs=r.crs,o.bbox=r.bbox,o.minScaleDenominator=r.minScaleDenominator,o.maxScaleDenominator=r.maxScaleDenominator,o.temporalExtent=r.temporalExtent,t.constraints.push(o);for(var s=0;s<r.multiConstraints.length;s++)o=new l.a,o.crs=r.crs,o.minScaleDenominator=r.minScaleDenominator,o.maxScaleDenominator=r.maxScaleDenominator,o.bbox=r.multiConstraints[s].bbox,o.temporalExtent=r.multiConstraints[s].temporalExtent,t.constraints.push(o)}else t.constraints.push(r)},CRS:function(e,t){t&&t.hasOwnProperty("crs")&&(t.crs=s(e))},Thematic:function(e,t){if(t){var r=new E.a;r.inspire=!1,r.name=s(e),t.thematics&&Array.isArray(t.thematics)||(t.thematics=[]),t.thematics.push(r)}},InspireThematic:function(e,t){if(t){var r=new E.a;r.inspire=!0,r.name=s(e),t.thematics&&Array.isArray(t.thematics)||(t.thematics=[]),t.thematics.push(r)}},Originator:function(e,t){if(t){var r=new f.a;r.name=e.getAttribute("name"),n(e,r),t.originators&&Array.isArray(t.originators)||(t.originators=[]),t.originators.push(r)}},Attribution:function(e,t){t&&t.hasOwnProperty("attribution")&&(t.attribution=s(e))},Logo:function(e,t){t&&t.hasOwnProperty("logo")&&(t.logo=s(e))},URL:function(e,t){t&&t.hasOwnProperty("url")&&(t.url=s(e))},Legend:function(e,t){var r=new p.a;n(e,r),t&&(t.legends&&Array.isArray(t.legends)||(t.legends=[]),t.legends.push(r))},LegendURL:function(e,t){if(t&&t.hasOwnProperty("format")&&(t.format=e.getAttribute("format"),e.hasChildNodes)){var r=e.childNodes[0];"OnlineResource"===(r.localName||r.baseName||r.nodeName)&&t.hasOwnProperty("url")&&(t.url=r.getAttribute("xlink:href"))}},QuickLook:function(e,t){if(e.hasChildNodes){var r=e.childNodes[0];"OnlineResource"===(r.localName||r.baseName||r.nodeName)&&t&&(t.quicklookUrl=r.getAttribute("xlink:href"))}},MetadataURL:function(e,t){if(t){var r=new h.a;if(r.format=e.getAttribute("format"),e.hasChildNodes){var o=e.childNodes[0];"OnlineResource"===(o.localName||o.baseName||o.nodeName)&&(r.url=o.getAttribute("xlink:href"))}t.metadata||Array.isArray(t.metadata)||(t.metadata=[]),t.metadata.push(r)}},Key:function(e,t){if(t){var r=e.getAttribute("id");t.apiKeys&&Array.isArray(t.apiKeys)||(t.apiKeys=[]),t.apiKeys.push(r);var o=s(e);t.serviceParams||(t.serviceParams={}),t.serviceParams.serverUrl||(t.serviceParams.serverUrl={}),t.serviceParams.serverUrl[r]||(t.serviceParams.serverUrl[r]=o)}}},ows:{Identifier:function(e,t){t&&t.hasOwnProperty("TMS")?t.identifier=s(e):t&&t.hasOwnProperty("matrixId")&&(t.matrixId=s(e))},SupportedCRS:function(e,t){t&&t.TMS&&t.TMS.hasOwnProperty("projection")&&(t.TMS.projection=s(e))}},sld:{MinScaleDenominator:function(e,t){var r=s(e);r&&t&&(t.hasOwnProperty("defaultOptions")?t.defaultOptions.minScaleDenominator=parseFloat(r):t.lyr?(t.lyr.globalConstraint||(t.lyr.globalConstraint=new l.a),t.lyr.globalConstraint.minScaleDenominator=parseFloat(r)):t.hasOwnProperty("minScaleDenominator")&&(t.minScaleDenominator=parseFloat(r)))},MaxScaleDenominator:function(e,t){var r=s(e);r&&t&&(t.hasOwnProperty("defaultOptions")?t.defaultOptions.maxScaleDenominator=parseFloat(r):t.lyr?(t.lyr.globalConstraint||(t.lyr.globalConstraint=new l.a),t.lyr.globalConstraint.maxScaleDenominator=parseFloat(r)):t.hasOwnProperty("maxScaleDenominator")&&(t.maxScaleDenominator=parseFloat(r)))}},wmts:{TileMatrixSetLimits:function(e,t){if(t){var r={};n(e,r),t.wmtsOptions||(t.wmtsOptions={}),t.wmtsOptions.tileMatrixSetLimits=r}},TileMatrixLimits:function(e,t){var r,o=new y.a;if(e.hasChildNodes){for(var n=e.childNodes,i=0;i<n.length;i++){var a=n[i],l=a.localName||a.baseName||a.nodeName;"TileMatrix"===l?r=s(a):"MinTileRow"===l?o.minTileRow=s(a):"MaxTileRow"===l?o.maxTileRow=s(a):"MinTileCol"===l?o.minTileCol=s(a):"MaxTileCol"===l&&(o.maxTileCol=s(a))}r&&t&&!t[r]&&(t[r]=o)}},TileMatrixSet:function(e,t){if(t&&t.tileMatrixSets){var r={};r.TMS=new _.a,r.resolutions=[],n(e,r);var o=r.TMS.tileMatrices;for(var i in o)o.hasOwnProperty(i)&&r.TMS.matrixIds.push(i);if(("IGNF:WGS84G"===r.TMS.getProjection()||"EPSG:4326"===r.TMS.getProjection())&&t.generalOptions&&Array.isArray(t.generalOptions.wgs84Resolutions))for(var a=t.generalOptions.wgs84Resolutions,l=0;l<a.length;l++)r.resolutions[l]=parseFloat(a[l]);Array.isArray(r.resolutions)&&void 0!==r.resolutions.sort&&r.resolutions.sort(function(e,t){return t-e}),r.TMS.nativeResolutions=r.resolutions,t.tileMatrixSets[r.identifier]=r.TMS}else t&&!t.wmtsOptions&&(t.wmtsOptions={}),t.wmtsOptions.tileMatrixSetLink=s(e)},TileMatrix:function(e,t){if(t){var r=new v.a;if(n(e,r),t.TMS&&t.TMS.getProjection()){var o=t.TMS.getProjection();if("EPSG:3857"===o||"EPSG:2154"===o){var s=28e-5*r.scaleDenominator;t.resolutions&&Array.isArray(t.resolutions)&&t.resolutions.push(s)}}t.TMS&&t.TMS.tileMatrices&&(t.TMS.tileMatrices[r.matrixId]=r)}},ScaleDenominator:function(e,t){var r=s(e);r&&t&&t.hasOwnProperty("scaleDenominator")&&(t.scaleDenominator=parseFloat(r))},TopLeftCorner:function(e,t){var r=s(e).split(" ");r&&t&&(t.topLeftCorner={},t.topLeftCorner.x=parseFloat(r[0]),t.topLeftCorner.y=parseFloat(r[1]))},TileWidth:function(e,t){var r=s(e);r&&t&&t.hasOwnProperty("tileWidth")&&(t.tileWidth=parseInt(r,10))},TileHeight:function(e,t){var r=s(e);r&&t&&t.hasOwnProperty("tileHeight")&&(t.tileHeight=parseInt(r,10))},MatrixWidth:function(e,t){var r=s(e);r&&t&&t.hasOwnProperty("matrixWidth")&&(t.matrixWidth=parseInt(r,10))},MatrixHeight:function(e,t){var r=s(e);r&&t&&t.hasOwnProperty("matrixHeight")&&(t.matrixHeight=parseInt(r,10))}},serviceException:function(e){var t={};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++)r=o[n],"exception"===r.nodeName&&(t.exceptionReport=R.READERS.exception(r));return t},exception:function(e){var t={},r=e.getAttribute("code");r&&(t.exceptionCode=r);var o=e.firstChild;return o&&3===o.nodeType&&(t.exception=o.nodeValue),t}},R.read=function(e){if("ViewContext"===e.nodeName){var t=e.prefix||R.DEFAULTPREFIX;return R.READERS[t][e.nodeName](e)}if("serviceException"===e.nodeName){return R.READERS[e.nodeName](e)}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},t.a=R},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","Geocode"));if(this.CLASSNAME="Geocode",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]"),!e.location)throw new Error(s.a.getMessage("PARAM_MISSING","location"));if("object"==typeof e.location&&0===Object.keys(e.location).length)throw new Error(s.a.getMessage("PARAM_EMPTY","location"));if("string"==typeof e.location&&0===e.location.length)throw new Error(s.a.getMessage("PARAM_EMPTY","location"));this.options.location=e.location,e.filterOptions&&"object"==typeof e.filterOptions||(this.options.filterOptions=e.filterOptions={type:["StreetAddress"]}),0===Object.keys(e.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var t=Object.keys(e.filterOptions),r=0;r<t.length;r++){var i=t[r];-1!==["department","number","postalCode","insee","importance","ID","IDTR","absorbedCity","sheet","section","inseeRegion","inseeDepartment"].indexOf(i)&&"string"!=typeof e.filterOptions[i]&&(e.filterOptions[i]=e.filterOptions[i].toString()),e.filterOptions[i]||delete this.options.filterOptions[i]}this.options.filterOptions.type=e.filterOptions.type||["StreetAddress"],this.options.maximumResponses=e.maximumResponses||25,this.options.returnFreeForm=e.returnFreeForm||!1,this.options.srs=e.srs||"EPSG:4326",this.options.outputFormat=this.options.rawResponse?"":"xml"}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(65),c=r(77);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){var r={httpMethod:this.options.httpMethod,location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=l.a.build(r),this.request?t.call(this,this.request):e.call(this,new i.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};c.a.build(r)}else e.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(11),s=r(39),i=r(13),a=r(73),l=r(74),c=r(75),u=r(76),p={build:function(e){var t=o.a.getLogger("DirectGeocodeRequestFactory");t.trace(["DirectGeocodeRequestFactory::build()"]);var r=null,p=new i.a;p.addFilterExtensions(new u.a),p.addFilterExtensions(new a.a),p.addFilterExtensions(new l.a),p.addFilterExtensions(new c.a);var h=new s.a({location:e.location,returnFreeForm:e.returnFreeForm,filterOptions:e.filterOptions});h.addFilter(p);var f=new n.a({srsName:e.srs,maximumResponses:e.maximumResponses});if(f.namespace=!0,f.setService(h),r=f.build(),"GET"===e.httpMethod){r="qxml="+encodeURIComponent(r).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}return t.trace(r),r}};t.a=p},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RequestHeader ()]"),!(this instanceof o))throw new TypeError("RequestHeader constructor cannot be called as a function.");this.options=e||{srsName:"EPSG:4326"};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}var n=r(0);o.prototype={requestString:null,template:'<RequestHeader srsName="__SRSNAME__"/>',constructor:o,toString:function(){var e=null;return e=this.template,e=e.replace(/__SRSNAME__/g,this.options.srsName),this.requestString=e,this.requestString}},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur Request ()]"),!(this instanceof o))throw new TypeError("Request constructor cannot be called as a function.");this.options=e||{maximumResponses:25,methodName:null,version:"1.2"};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}var n=r(0);o.prototype={requestString:null,template:'<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__">\x3c!-- __REQUESTSERVICE__ --\x3e</Request>',constructor:o,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},toString:function(){var e=null;return e=this.template,e=e.replace(/__MAXRESPONSES__/g,this.options.maximumResponses),e=e.replace(/__METHODNAME__/g,this.options.methodName),e=e.replace(/__UUID__/g,this.guid()),e=e.replace(/__VERSION__/g,this.options.version),this.requestString=e,this.requestString}},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur GeocodeRequest ()]"),!(this instanceof o))throw new TypeError("GeocodeRequest constructor cannot be called as a function.");this.options=e||{};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.CLASSNAME="GeocodeRequest"}var n=r(0),s=r(69),i=r(13);o.prototype={strRequest:null,oAddress:null,oFilter:null,template:'<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">__ADDRESS__</GeocodeRequest>',addAddress:function(e){e instanceof s.a&&(this.oAddress=e)},addFilter:function(e){e instanceof i.a&&(this.oFilter=e)},constructor:o,toString:function(){var e="";if(e=this.template,!this.oAddress){var t={};if(t.location=this.options.location,t.type=this.options.filterOptions.type||["StreetAddress"],t.filter=this.options.filterOptions,delete t.filter.type,this.oFilter){t.filter={};for(var r in t.type){var o=t.type[r],n=this.oFilter.getFilter(o);if(n){for(var i=this.options.filterOptions,a=n.attributesList,l=0;l<a.length;l++){var c=a[l];if(i[c]){var u=n.serviceAttributes[l];n.placeAttributes[u]=i[c],this.logger.trace("Selection du filtre '"+c+"' sur le type '"+o+"'.")}}var p=n.placeAttributes;for(var h in p)p.hasOwnProperty(h)&&(t.filter[h]=p[h])}else this.logger.warn("Le filtre '"+o+"' n'existe pas !?")}}if(this.oAddress=new s.a(t),!this.oAddress)throw new Error("La construction de l'adresse n'est pas correctement definie !?")}return e=e.replace(/__ADDRESS__/g,this.oAddress.toString()),e=e.replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=e,this.strRequest}},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("Address"),this.logger.trace("[Constructeur Address ()]"),!(this instanceof o))throw new TypeError("Address constructor cannot be called as a function.");if(this.options=e||{location:{},type:["StreetAddress"],filter:{}},!e.location)throw new Error("l'option 'location' n'est pas renseignée !");for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}var n=r(0);o.prototype={constructor:o,requestString:null,template:{address:'<Address countryCode="__COUNTRYCODE__">__LOCATION____PLACE____POSTALCODE____ENVELOPE__</Address>',location:{freeFormAddress:"<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>",streetAddress:{container:"<StreetAddress>__STREET____BUILDING__</StreetAddress>",building:'<Building number="__BUILDINGVALUE__"/>',street:"<Street>__STREETVALUE__</Street>"}},place:'<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',postalCode:"<PostalCode>__POSTALCODEVALUE__</PostalCode>",envelope:"<gml:Envelope><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>"}},o.prototype.toString=function(){var e=null;if(e=this.template.address,e=e.replace(/__COUNTRYCODE__/g,this.options.type),"string"==typeof this.options.location){var t=this.template.location.freeFormAddress;t=t.replace(/__FREEFORMADDRESSVALUE__/g,this.options.location),e=e.replace(/__LOCATION__/g,t)}else{var r="",o="";this.options.location.number&&(r=this.template.location.streetAddress.building,r=r.replace(/__BUILDINGVALUE__/g,this.options.location.number)),this.options.location.street&&(o=this.template.location.streetAddress.street,o=o.replace(/__STREETVALUE__/g,this.options.location.street));var n=this.template.location.streetAddress.container;n=n.replace(/__STREET__/g,o),n=n.replace(/__BUILDING__/g,r),e=e.replace(/__LOCATION__/g,n)}var s="";this.options.location.postalCode&&(s=this.template.postalCode,s=s.replace(/__POSTALCODEVALUE__/g,this.options.location.postalCode));var i="";if(this.options.filter){var a=this.options.filter.bbox;a&&(i=this.template.envelope,i=i.replace(/__LEFT__/g,a.left),i=i.replace(/__BOTTOM__/g,a.bottom),i=i.replace(/__RIGHT__/g,a.right),i=i.replace(/__TOP__/g,a.top))}var l=[],c="";if(this.options.filter){var u=this.options.filter;for(var p in u)"bbox"!==p&&(c=this.template.place,c=c.replace(/__PLACETYPE__/g,p),c=c.replace(/__PLACEVALUE__/g,u[p]),l.push(c))}var h="";return this.options.location.city&&(h=this.template.place,h=h.replace(/__PLACETYPE__/g,"Municipality"),h=h.replace(/__PLACEVALUE__/g,this.options.location.city),l.push(h)),e=e.replace(/__POSTALCODE__/g,s),e=e.replace(/__PLACE__/g,l.join("\n")),e=e.replace(/__ENVELOPE__/g,i),this.requestString=e,this.requestString},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur ReverseGeocodeRequest ()]"),!(this instanceof o))throw new TypeError("ReverseGeocodeRequest constructor cannot be called as a function.");this.options=e||{};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.CLASSNAME="ReverseGeocodeRequest"}var n=r(0),s=r(71),i=r(72);o.prototype={strRequest:null,oPosition:null,oPreference:null,constructor:o,template:'<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">__POSITION____PREFERENCE__</ReverseGeocodeRequest>',addPosition:function(e){e instanceof s.a&&(this.oPosition=e)},addPreferences:function(e){e instanceof i.a&&(this.oPreference=e)},toString:function(){var e="";if(e=this.template,!this.oPreference&&(this.oPreference=new i.a(this.options.filterOptions.type||["StreetAddress"]),!this.oPreference))throw new Error("Les preferences ne sont pas definies !?");if(e=e.replace(/__PREFERENCE__/g,this.oPreference.toString()),!this.oPosition){var t={position:this.options.position,filter:{}};if(this.options.filterOptions&&(t.filter=this.options.filterOptions,delete t.filter.type),this.oPosition=new s.a(t),!this.oPosition)throw new Error("La position et ses filtres ne sont pas definis !?")}return e=e.replace(/__POSITION__/g,this.oPosition.toString()),e=e.replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=e,this.strRequest}},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("Position"),this.logger.trace("[Constructeur Position ()]"),!(this instanceof o))throw new TypeError("Position constructor cannot be called as a function.");if(this.options=e||{},!e.position)throw new Error("l'option 'position' n'est pas renseignée !");for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}var n=r(0);o.prototype={constructor:o,requestString:null,template:{position:"<Position>__GMLPOINT____GMLFILTER__</Position>",gml:{point:'<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',pos:null,filter:{bbox:'<gml:Envelope xmlns:gml="http://www.opengis.net/gml"><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>',circle:'<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',polygon:'<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',multipolygon:null}}}},o.prototype.toString=function(){var e=this.template.position,t=this.template.gml.point;t=t.replace(/__X__/g,this.options.position.x),t=t.replace(/__Y__/g,this.options.position.y);var r="";if(this.options.filter){var o=this.options.filter;for(var n in o)switch(n){case"circle":r=this.template.gml.filter[n],r=r.replace(/__X__/g,o[n].x),r=r.replace(/__Y__/g,o[n].y),r=r.replace(/__RADIUS__/g,o[n].radius);break;case"bbox":r=this.template.gml.filter[n],r=r.replace(/__LEFT__/g,o[n].left),r=r.replace(/__BOTTOM__/g,o[n].bottom),r=r.replace(/__RIGHT__/g,o[n].right),r=r.replace(/__TOP__/g,o[n].top);break;case"polygon":r=this.template.gml.filter[n];for(var s="",i=o[n],a=0;a<i.length;a++){var l=i[a];if(Array.isArray(l)){this.logger.error("Holes are not implemented !");break}(l.x&&l.y||0===l.x||0===l.y)&&(s+=l.x+" "+l.y),i.length!==a+1&&(s+=" ")}r=r.replace(/__XY__/g,s);break;case"multipolygon":this.logger.warn("Filter '"+n+"' is not yet implemented !");break;default:this.logger.error("This filter '"+n+"' is not useful !")}}return e=e.replace(/__GMLPOINT__/g,t),e=e.replace(/__GMLFILTER__/g,r),this.requestString=e,this.requestString},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("Preference"),this.logger.trace("[Constructeur Preference ()]"),!(this instanceof o))throw new TypeError("Preference constructor cannot be called as a function.");this.type=e}var n=r(0);o.prototype={constructor:o,requestString:null,template:"<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>"},o.prototype.toString=function(){for(var e=[],t="",r=0;r<this.type.length;r++)t=this.template,t=t.replace(/__TYPE__/g,this.type[r]),e.push(t);return this.strRequest=e.join("\n"),this.strRequest},t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("StreetAddress constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="StreetAddress",this.attributesList=["bbox","ID","IDTR","quality","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","ID","IDTR","Qualite","Territoire","Commune","Departement","INSEE","Municipality"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("PositionOfInterest constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="PositionOfInterest",this.attributesList=["bbox","importance","nature","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","Importance","Nature","Territoire","Commune","Departement","INSEE","Municipality"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("CadastralParcel constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="CadastralParcel",this.attributesList=["absorbedCity","sheet","number","section","commune","department","insee","municipality","origin"],this.serviceAttributes=["CommuneAbsorbee","Feuille","Numero","Section","Commune","Departement","INSEE","Municipality","Type"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Administratif constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="Administratif",this.attributesList=["bbox","prefecture","inseeRegion","inseeDepartment","municipality"],this.serviceAttributes=["bbox","Prefecture","InseeRegion","InseeDepartement","Municipality"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";var o=r(2),n=r(1),s=r(6),i=r(78),a={build:function(e){var t=null;if(!e.response)return void e.onError.call(e.scope,new o.a({message:n.a.getMessage("SERVICE_RESPONSE_EMPTY"),type:o.a.TYPE_SRVERR,status:-1}));if(e.rawResponse)t=e.response;else{try{var r=new s.a({reader:i.a});if("string"==typeof e.response?r.setXMLString(e.response):r.setXMLDoc(e.response),!(t=r.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(t){var a=t.message;return"string"==typeof e.response?a+="('"+e.response+"')":a+="('"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new o.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE",a),type:o.a.TYPE_UNKERR,status:-1}))}if(t.exceptionReport)return void e.onError.call(e.scope,new o.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:o.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,t)}};t.a=a},function(e,t,r){"use strict";function o(e){if(e.attributes.length>0){for(var t={},r=e.attributes,o=0;o<r.length;o++){var n=r[o];t[n.nodeName]=n.nodeValue}return t}}function n(e,t){if(e.hasChildNodes())for(var r,o,s,i=e.childNodes,a=0;a<i.length;a++)if(r=i[a],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,s=r.prefix||p.DEFAULTPREFIX,p.READERS[s][o]){var l=p.READERS[s][o];l(r,t)}else n(r,t)}function s(e){var t,r="";return e.hasChildNodes()&&(t=e.firstChild,3===t.nodeType&&(r=t.nodeValue)),r}function i(e){if(e.attributes.length>0){var t=o(e);for(var r in t)if(t.hasOwnProperty(r)){if("version"===r&&t.version!==p.VERSION)return void console.log("[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===r){if(t[r]!==p.NAMESPACES[p.DEFAULTPREFIX])return void console.log("[DirectGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var n=r.split(":")[0],s=r.split(":")[1];if("xmlns"===n&&s&&p.NAMESPACES[s]&&p.NAMESPACES[s]!==t[r])return void console.log("[DirectGeocodeResponseReader] geocode response "+r+" namespace is not the expected one");if("schemaLocation"===s&&p.SCHEMALOCATION!==t[r])return void console.log("[DirectGeocodeResponseReader] geocode response schema location is not the expected one")}}}var a=r(1),l=r(2),c=r(14),u=r(40),p={};p.VERSION="1.2",p.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},p.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",p.DEFAULTPREFIX="xls",p.READERS={xls:{XLS:function(e){var t=new c.a;return i(e),n(e,t),t},GeocodedAddress:function(e,t){var r=new u.a;n(e,r),t&&Array.isArray(t.locations)&&t.locations.push(r)},GeocodeMatchCode:function(e,t){var r=e.getAttribute("accuracy");r&&t&&(t.accuracy=parseFloat(r));var o=e.getAttribute("matchType");o&&t&&(t.matchType=o)},Address:function(e,t){var r=e.getAttribute("countryCode");t&&r&&(t.type=r),n(e,t)},freeFormAddress:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.freeform=s(e))},Building:function(e,t){var r=e.getAttribute("number");t&&t.hasOwnProperty("placeAttributes")&&(r?t.placeAttributes.number=r:e.getAttribute("buildingName")?t.placeAttributes.number=e.getAttribute("buildingName"):e.getAttribute("subdivision")&&(t.placeAttributes.number=e.getAttribute("subdivision")))},Street:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&("StreetAddress"===t.type?t.placeAttributes.street=s(e):"CadastralParcel"===t.type&&(t.placeAttributes.cadastralParcel=s(e)))},Place:function(e,t){var r=e.getAttribute("type"),o=s(e);if(t&&t.hasOwnProperty("placeAttributes"))if("Municipality"===r)t.placeAttributes.municipality=o;else if("Bbox"===r){var n=o.split(";");4===n.length&&(t.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===r?t.placeAttributes.commune=o:"Departement"===r?t.placeAttributes.department=o:"INSEE"===r?t.placeAttributes.insee=o:"Qualite"===r?t.placeAttributes.quality=o:"Territoire"===r?t.placeAttributes.territory=o:"ID"===r?t.placeAttributes.ID=o:"ID_TR"===r?t.placeAttributes.IDTR=o:"Importance"===r?t.placeAttributes.importance=parseInt(o,10):"Nature"===r?t.placeAttributes.nature=o:"Numero"===r?t.placeAttributes.number=o:"Feuille"===r?t.placeAttributes.sheet=o:"Section"===r?t.placeAttributes.section=o:"CommuneAbsorbee"===r?t.placeAttributes.absorbedCity=o:"Arrondissement"===r?o&&(t.placeAttributes.arrondissement=o):"Type"===r?t.placeAttributes.origin=o:"Prefecture"===r?t.placeAttributes.prefecture=o:"InseeRegion"===r?t.placeAttributes.inseeRegion=o:"InseeDepartment"===r&&(t.placeAttributes.inseeDepartment=o)},PostalCode:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.postalCode=s(e))},Error:function(e){var t=e.getAttribute("message"),r=e.getAttribute("errorCode"),o=a.a.getMessage("SERVICE_RESPONSE_EXCEPTION","("+r+") : "+t);throw new l.a({message:o,type:l.a.TYPE_SRVERR})}},gml:{pos:function(e,t){var r=s(e);t&&r&&(t.position={x:parseFloat(r.split(" ")[0]),y:parseFloat(r.split(" ")[1])})}},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(t.exceptionReport=p.READERS.Exception(r));return t},Exception:function(e){var t={},r=e.getAttribute("exceptionCode");r&&(t.exceptionCode=r);var o=e.firstChild;return o&&3===o.nodeType&&(t.exception=o.nodeValue),t}},p.read=function(e){if("XLS"===e.nodeName){var t=e.prefix;t||(t=p.DEFAULTPREFIX);return p.READERS[t][e.nodeName](e)}if("ExceptionReport"===e.nodeName){return p.READERS[e.nodeName](e)}var r=a.a.getMessage("SERVICE_RESPONSE_ANALYSE",e.nodeName);throw new l.a({message:r,type:l.a.TYPE_UNKERR,status:200})},t.a=p},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));if(this.CLASSNAME="ReverseGeocode",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]"),!e.position)throw new Error(s.a.getMessage("PARAM_MISSING","position"));if(null===e.position.x)throw new Error(s.a.getMessage("PARAM_MISSING","position.x"));if(null===e.position.y)throw new Error(s.a.getMessage("PARAM_MISSING","position.y"));this.options.position=e.position,e.filterOptions&&"object"==typeof e.filterOptions||(this.options.filterOptions=e.filterOptions={type:["StreetAddress"]}),0===Object.keys(e.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var t=Object.keys(e.filterOptions),r=0;r<t.length;r++){var i=t[r];e.filterOptions[i]&&0!==Object.keys(e.filterOptions[i]).length||delete this.options.filterOptions[i]}if(this.options.filterOptions.type=e.filterOptions.type||["StreetAddress"],!Array.isArray(this.options.filterOptions.type))throw new Error(s.a.getMessage("PARAM_TYPE","filterOptions.type"));if(this.options.maximumResponses=e.maximumResponses||25,this.options.returnFreeForm=e.returnFreeForm||!1,this.options.srs=e.srs||"CRS:84",-1===o.geoEPSG.indexOf(this.options.srs)){if(this.options.position={x:this.options.position.y,y:this.options.position.x},this.options.filterOptions&&this.options.filterOptions.circle){var l=this.options.filterOptions.circle;this.options.filterOptions.circle={x:l.y,y:l.x,radius:l.radius}}if(this.options.filterOptions&&this.options.filterOptions.polygon){var c=this.options.filterOptions.polygon;for(r=0;r<c.length;r++){var u=c[r];this.options.filterOptions.polygon[r]={x:u.y,y:u.x}}}}this.options.outputFormat=this.options.rawResponse?"":"xml"}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(80),c=r(81);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){var r={httpMethod:this.options.httpMethod,position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:"EPSG:4326",maximumResponses:this.options.maximumResponses};this.request=l.a.build(r),this.request?t.call(this,this.request):e.call(this,new i.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};c.a.build(r)}else e.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},o.geoEPSG=["EPSG:4326"],t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(11),s=r(39),i={build:function(e){var t=o.a.getLogger("ReverseGeocodeRequestFactory");t.trace(["ReverseGeocodeRequestFactory::build()"]);var r=e||{},i=null,a=new s.a({position:r.position,returnFreeForm:r.returnFreeForm,filterOptions:r.filterOptions}),l=new n.a({srsName:r.srs,maximumResponses:r.maximumResponses});if(l.namespace=!0,l.setService(a),i=l.build(),"GET"===r.httpMethod){i="qxml="+encodeURIComponent(i).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}return t.trace(i),i}};t.a=i},function(e,t,r){"use strict";var o=r(1),n=r(2),s=r(6),i=r(82),a={build:function(e){var t=null;if(!e.response)return void e.onError.call(e.scope,new n.a({message:o.a.getMessage("SERVICE_RESPONSE_EMPTY"),type:n.a.TYPE_SRVERR,status:-1}));if(e.rawResponse)t=e.response;else{try{var r=new s.a({reader:i.a});if("string"==typeof e.response?r.setXMLString(e.response):r.setXMLDoc(e.response),!(t=r.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(t){return t.status=200,void e.onError.call(e.scope,t)}if(t.exceptionReport)return void e.onError.call(e.scope,new n.a({message:o.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:n.a.TYPE_SRVERR,status:200}));if(e.scope&&e.scope.options&&e.scope.options.srs&&"EPSG:4326"!==e.scope.options.srs){var a,l;if(t||t.locations||t.locations.length)for(var c=0;c<t.locations.length;c++)(a=t.locations[c])&&(l=a.position)&&(a.position={x:l.y,y:l.x})}}e.onSuccess.call(e.scope,t)}};t.a=a},function(e,t,r){"use strict";function o(e){if(e.attributes.length>0){for(var t={},r=e.attributes,o=0;o<r.length;o++){var n=r[o];t[n.nodeName]=n.nodeValue}return t}}function n(e,t){if(e.hasChildNodes())for(var r,o,s,i=e.childNodes,a=0;a<i.length;a++)if(r=i[a],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,s=r.prefix||p.DEFAULTPREFIX,p.READERS[s][o]){var l=p.READERS[s][o];l(r,t)}else n(r,t)}function s(e){var t,r="";return e.hasChildNodes()&&(t=e.firstChild,3===t.nodeType&&(r=t.nodeValue)),r}function i(e){if(e.attributes.length>0){var t=o(e);for(var r in t)if(t.hasOwnProperty(r)){if("version"===r&&t.version!==p.VERSION)return void console.log("[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===r){if(t[r]!==p.NAMESPACES[p.DEFAULTPREFIX])return void console.log("[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var n=r.split(":")[0],s=r.split(":")[1];if("xmlns"===n&&s&&p.NAMESPACES[s]&&p.NAMESPACES[s]!==t[r])return void console.log("[ReverseGeocodeResponseReader] geocode response "+r+" namespace is not the expected one");if("schemaLocation"===s&&p.SCHEMALOCATION!==t[r])return void console.log("[ReverseGeocodeResponseReader] geocode response schema location is not the expected one")}}}var a=r(1),l=r(2),c=r(14),u=r(41),p={};p.VERSION="1.2",p.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},p.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",p.DEFAULTPREFIX="xls",p.READERS={xls:{XLS:function(e){var t=new c.a;return i(e),n(e,t),t},ReverseGeocodedLocation:function(e,t){var r=new u.a;n(e,r),t&&Array.isArray(t.locations)&&t.locations.push(r)},Address:function(e,t){var r=e.getAttribute("countryCode");t&&r&&(t.type=r),n(e,t)},Building:function(e,t){var r=e.getAttribute("number");t&&t.hasOwnProperty("placeAttributes")&&(r?t.placeAttributes.number=r:e.getAttribute("buildingName")?t.placeAttributes.number=e.getAttribute("buildingName"):e.getAttribute("subdivision")&&(t.placeAttributes.number=e.getAttribute("subdivision")))},Street:function(e,t){"StreetAddress"===t.type?t.placeAttributes.street=s(e):"CadastralParcel"===t.type&&(t.placeAttributes.cadastralParcel=s(e))},Place:function(e,t){var r=e.getAttribute("type"),o=s(e);if(t&&t.hasOwnProperty("placeAttributes"))if("Municipality"===r)t.placeAttributes.municipality=o;else if("Bbox"===r){var n=o.split(";");4===n.length&&(t.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===r?t.placeAttributes.commune=o:"Departement"===r?t.placeAttributes.department=o:"INSEE"===r?t.placeAttributes.insee=o:"Qualite"===r?t.placeAttributes.quality=o:"Territoire"===r?t.placeAttributes.territory=o:"ID"===r?t.placeAttributes.ID=o:"ID_TR"===r?t.placeAttributes.IDTR=o:"Importance"===r?t.placeAttributes.importance=parseInt(o,10):"Nature"===r?t.placeAttributes.nature=o:"Numero"===r?t.placeAttributes.number=o:"Feuille"===r?t.placeAttributes.sheet=o:"Section"===r?t.placeAttributes.section=o:"CommuneAbsorbee"===r?t.placeAttributes.absorbedCity=o:"Arrondissement"===r?o&&(t.placeAttributes.arrondissement=o):"Type"===r?t.placeAttributes.origin=o:"Prefecture"===r?t.placeAttributes.prefecture=o:"InseeRegion"===r?t.placeAttributes.inseeRegion=o:"InseeDepartment"===r&&(t.placeAttributes.inseeDepartment=o)},PostalCode:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.postalCode=s(e))},SearchCentreDistance:function(e,t){t&&(t.searchCenterDistance=parseFloat(e.getAttribute("value")))},Error:function(e){var t=e.getAttribute("message"),r=e.getAttribute("errorCode"),o=a.a.getMessage("SERVICE_RESPONSE_EXCEPTION","("+r+") : "+t);throw new l.a({message:o,type:l.a.TYPE_SRVERR})}},gml:{pos:function(e,t){var r=s(e);t&&r&&(t.position={x:parseFloat(r.split(" ")[0]),y:parseFloat(r.split(" ")[1])})}},xlsext:{ExtendedGeocodeMatchCode:function(e,t){t&&(t.matchType=s(e))}},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(t.exceptionReport=p.READERS.Exception(r));return t},Exception:function(e){var t={},r=e.getAttribute("exceptionCode");r&&(t.exceptionCode=r);var o=e.firstChild;return o&&3===o.nodeType&&(t.exception=o.nodeValue),t}},p.read=function(e){if("XLS"===e.nodeName){var t=e.prefix;t||(t=p.DEFAULTPREFIX);return p.READERS[t][e.nodeName](e)}if("ExceptionReport"===e.nodeName){return p.READERS[e.nodeName](e)}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},t.a=p},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(a.a.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));if(this.CLASSNAME="AutoComplete",n.a.apply(this,arguments),this.logger=i.a.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]"),!e.text)throw new Error(a.a.getMessage("PARAM_MISSING","text"));this.options.text=e.text,e.filterOptions&&"object"==typeof e.filterOptions||(this.options.filterOptions=e.filterOptions={territory:[],type:["StreetAddress"]}),0===Object.keys(e.filterOptions).length&&(this.options.filterOptions={territory:[],type:["StreetAddress"]}),this.options.filterOptions.type=e.filterOptions.type||["StreetAddress"],this.options.filterOptions.territory=e.filterOptions.territory||[],this.options.maximumResponses=e.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}var n=r(3),s=r(84),i=r(0),a=r(1),l=r(4),c=r(2);o.prototype=Object.create(n.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){var r="";this.options.filterOptions.territory&&(r=this.options.filterOptions.territory.join(";"));var o="";this.options.filterOptions.type&&(o=this.options.filterOptions.type.join(",")),this.request=l.a.normalyzeParameters({text:encodeURIComponent(this.options.text),type:o,terr:r,maximumResponses:this.options.maximumResponses}),this.request?t.call(this,this.request):e.call(this,new c.a(a.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={response:this.response,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};s.a.build(r)}else e.call(this,new c.a(a.a.getMessage("SERVICE_RESPONSE_EMPTY")))},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(42),a=r(43),l={build:function(e){var t=o.a.getLogger("AutoCompleteResponseFactory");t.trace(["AutoCompleteResponseFactory::build()"]);var r=null;if(!e.response)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(e.rawResponse)t.trace("analyze response : raw"),r=e.response;else{var l;if(l="string"==typeof e.response?JSON.parse(e.response):e.response){if(l.error)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",l.error.description),status:l.error.code,type:s.a.TYPE_SRVERR}));if(r=new i.a,!l.results||!Array.isArray(l.results))return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var c,u=0;u<l.results.length;u++){var p=l.results[u];c=new a.a,c&&(p&&"StreetAddress"===p.country?(c.street=p.street,c.type="StreetAddress"):p&&"PositionOfInterest"===p.country&&(c.poi=p.street,c.kind=p.kind,c.type="PositionOfInterest"),c.position&&(c.position.x=p.x,c.position.y=p.y),c.commune=p.city,c.fullText=p.fulltext,c.postalCode=p.zipcode,c.classification=p.classification),r.suggestedLocations.push(c)}if(!r.suggestedLocations.length)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!r)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:s.a.TYPE_UNKERR,status:-1}));if(r.exceptionReport)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",r.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,r)}};t.a=l},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!e.startPoint)throw new Error(s.a.getMessage("PARAM_MISSING","startPoint"));if(null===e.startPoint.x)throw new Error(s.a.getMessage("PARAM_MISSING","startPoint.x"));if(null===e.startPoint.y)throw new Error(s.a.getMessage("PARAM_MISSING","startPoint.y"));if(!e.endPoint)throw new Error(s.a.getMessage("PARAM_MISSING","endPoint"));if(null===e.endPoint.x)throw new Error(s.a.getMessage("PARAM_MISSING","endPoint.x"));if(null===e.endPoint.y)throw new Error(s.a.getMessage("PARAM_MISSING","endPoint.y"));if(this.options.api="string"==typeof e.api?e.api.toUpperCase():"REST",this.options.outputFormat="string"==typeof e.outputFormat?e.outputFormat.toLowerCase():"json",this.options.startPoint=e.startPoint,this.options.endPoint=e.endPoint,this.options.viaPoints=e.viaPoints||null,this.options.exclusions=e.exclusions||null,this.options.routePreference=e.routePreference||"fastest",this.options.graph=e.graph||"Voiture",this.options.geometryInInstructions=e.geometryInInstructions||!1,this.options.provideBbox=e.provideBbox||!0,this.options.distanceUnit=e.distanceUnit||"km",this.options.expectedStartTime=null,this.options.srs=e.srs||"EPSG:4326",this.options.api="REST",this.logger.warn("Surcharge option 'api' : REST (readers OLS non implémentés)"),"XHR"===this.options.protocol&&(this.options.httpMethod="GET",this.logger.trace("Surcharge option 'HttpMethod' : "+this.options.httpMethod)),!this.options.serverUrl){var t=l.a.Route.url(this.options.apiKey),r=null;switch(this.options.api){case"OLS":r=t.ols;break;case"REST":r=t["route-"+this.options.outputFormat];break;default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","api"))}if(!r)throw new Error("Url by default not found !");this.options.serverUrl=r,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var c=this.options.serverUrl.substring(i+1);if(c&&c.length<5)switch(this.logger.trace("Serveur Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(5),c=r(86),u=r(94);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){var r={api:this.options.api,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,exclusions:this.options.exclusions,distanceUnit:this.options.distanceUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs};this.request=c.a.build(r),this.request?t.call(this,this.request):e.call(this,new i.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={distanceUnit:this.options.distanceUnit,response:this.response,outputFormat:this.options.outputFormat,api:this.options.api,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};u.a.build(r)}else e.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(2),s=r(87),i=r(92),a={build:function(e){o.a.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var t=null,r=e||{},a=!(null===e.onError||"function"!=typeof e.onError),l=null;switch(e.api){case"REST":var c=new i.a(r);if(!c.processRequestString()){if(l="Error process request (rest) !",a)return void e.onError.call(e.scope,new n.a(l));throw new Error(l)}t=c.requestString;break;case"OLS":if(!(t=s.a.build(r))){if(l="Error process request (ols) !",a)return void e.onError.call(e.scope,new n.a(l));throw new Error(l)}break;default:if(l="Type of API is not supported by service (REST or OLS) !",a)return void e.onError.call(e.scope,new n.a(l));throw new Error(l)}return t}};t.a=a},function(e,t,r){"use strict";var o=r(0),n=r(11),s=r(88),i={build:function(e){o.a.getLogger("RouteRequestOLS").trace(["RouteRequestOLS::build()"]);var t=null,r={startPoint:e.startPoint,endPoint:e.endPoint,viaPoint:e.viaPoints,provideBoundingBox:e.provideBbox,avoidFeature:e.exclusions,expectedStartTime:e.expectedStartTime,distanceUnit:e.distanceUnit,graph:e.graph,provideGeometry:e.geometryInInstructions,routePreference:e.routePreference},i=new s.a(r),a=new n.a({srsName:e.srs,maximumResponses:e.maximumResponses});if(a.namespace=!0,a.setService(i),t=a.build(),"GET"===e.httpMethod){t="qxml="+encodeURIComponent(t).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}return t}};t.a=i},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RouteService ()]"),!(this instanceof o))throw new TypeError("RouteService constructor cannot be called as a function.");this.CLASSNAME="RouteService",this.CLASSTYPE="RouteRequest",s.a.apply(this,arguments)}var n=r(0),s=r(12),i=r(89),a=r(91),l=r.n(a);o.prototype=Object.create(s.a.prototype,{}),o.prototype.constructor=o,o.prototype.addRequest=function(e){if("DetermineRouteRequest"!==e.CLASSNAME)throw new Error("Ce n'est pas un objet de type 'Route Request' !?");this.oRequest=e},o.prototype.addFilter=function(e){e instanceof l.a&&(this.oFilter=e)},o.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("RouteRequest"===this.CLASSTYPE){var e={distanceUnit:this.options.distanceUnit||null,provideGeometry:this.options.provideGeometry||null,provideBoundingBox:this.options.provideBoundingBox||null,route:{routePreference:this.options.routePreference||null,startPoint:this.options.startPoint,viaPoint:this.options.viaPoint||null,endPoint:this.options.endPoint,avoidFeature:this.options.avoidFeature||null,graph:this.options.graph||null,expectedStartTime:this.options.expectedStartTime||null}};this.oRequest=new i.a(e),this.oFilter&&this.oRequest.addFilter(this.oFilter)}}if(!this.oRequest)throw new Error("Type de requête indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur DetermineRouteRequest ()]"),!(this instanceof o))throw new TypeError("DetermineRouteRequest constructor cannot be called as a function.");this.options=e||{};for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.CLASSNAME="DetermineRouteRequest"}var n=r(0),s=r(90);o.prototype={strRequest:null,oRoutePlan:null,template:{determineRouteRequest:'<DetermineRouteRequest distanceUnit="__DISTANCEUNIT__">__ROUTEPLAN____ROUTEINSTRUCTIONREQUEST____ROUTEGEOMETRYREQUEST____ROUTEMAPREQUEST__</DetermineRouteRequest>',routeInstructionRequest:'<RouteInstructionsRequest provideGeometry="__PROVIDEGEOMETRY__" provideBoundingBox="__PROVIDEBBOX__" />',routeGeometryRequest:"<RouteGeometryRequest />",routeMapRequest:""},addRoute:function(e){e instanceof s.a&&(this.oRoutePlan=e)},constructor:o,toString:function(){var e="";if(e=this.template.determineRouteRequest,e=e.replace(/__DISTANCEUNIT__/g,this.options.distanceUnit||"KM"),!this.oRoutePlan){var t=this.options.route;if(this.oRoutePlan=new s.a(t),!this.oRoutePlan)throw new Error("La construction du calcul d'initineraire n'est pas correctement definie !?")}e=e.replace(/__ROUTEPLAN__/g,this.oRoutePlan.toString());var r=this.template.routeInstructionRequest;r=r.replace(/__PROVIDEGEOMETRY__/g,this.options.provideGeometry||!1),r=r.replace(/__PROVIDEBBOX__/g,this.options.provideBoundingBox||!1),e=e.replace(/__ROUTEINSTRUCTIONREQUEST__/g,r);var o=this.template.routeGeometryRequest;e=e.replace(/__ROUTEGEOMETRYREQUEST__/g,o);var n=this.template.routeMapRequest;return e=e.replace(/__ROUTEMAPREQUEST__/g,n),this.strRequest=e,this.strRequest}},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("RoutePlan"),this.logger.trace("[Constructeur RoutePlan ()]"),!(this instanceof o))throw new TypeError("RoutePlan constructor cannot be called as a function.");if(this.options=e||{},!e.startPoint)throw new Error("l'option 'startPoint' n'est pas renseignée !");if(!e.endPoint)throw new Error("l'option 'endPoint' n'est pas renseignée !");for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}var n=r(0);o.prototype={constructor:o,requestString:null,template:{routePlan:"<RoutePlan>__ROUTEPREFERENCE____GRAPH____WAYPOINTLIST____AVOIDLIST__</RoutePlan>",routePreference:"<RoutePreference>__VALUEROUTEPREFERENCE__</RoutePreference>",graph:'<xlsext:graphName xmlns:xlsext="http://www.opengis.net/xlsext" name="__VALUEGRAPH__"/>',wayPointList:{container:"<WayPointList>__STARTPOINT____VIAPOINT____ENDPOINT__</WayPointList>",point:'<Position><gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point></Position>',startPoint:"<StartPoint>__POINT__</StartPoint>",endPoint:"<EndPoint>__POINT__</EndPoint>",viaPoint:"<ViaPoint>__POINT__</ViaPoint>"},avoidList:{container:"<AvoidList>__AVOIDFEATURE__</AvoidList>",avoidFeature:"<AvoidFeature>__VALUEAVOIDFEATURE__</AvoidFeature>"}},toString:function(){var e="";if(e=this.template.routePlan,this.options.routePreference){var t=this.template.routePreference;t=t.replace(/__VALUEROUTEPREFERENCE__/,this.options.routePreference),e=e.replace(/__ROUTEPREFERENCE__/g,t)}if(e=e.replace(/__ROUTEPREFERENCE__/g,""),this.options.avoidFeature){for(var r=this.template.avoidList.container,o=[],n=0;n<this.options.avoidFeature.length;n++){var s=this.template.avoidList.avoidFeature;s=s.replace(/__VALUEAVOIDFEATURE__/,this.options.avoidFeature[n]),o.push(s)}r=r.replace(/__AVOIDFEATURE__/,o.join("\n")),e=e.replace(/__AVOIDLIST__/g,r)}if(e=e.replace(/__AVOIDLIST__/g,""),this.options.graph){var i=this.template.graph;i=i.replace(/__VALUEGRAPH__/,this.options.graph),e=e.replace(/__GRAPH__/g,i)}e=e.replace(/__GRAPH__/g,"");var a=this.template.wayPointList.container,l="";if(l=this.template.wayPointList.point,l=l.replace(/__X__/,this.options.startPoint.x),l=l.replace(/__Y__/,this.options.startPoint.y),a=a.replace(/__STARTPOINT__/,this.template.wayPointList.startPoint.replace(/__POINT__/,l)),l=this.template.wayPointList.point,l=l.replace(/__X__/,this.options.endPoint.x),l=l.replace(/__Y__/,this.options.endPoint.y),a=a.replace(/__ENDPOINT__/,this.template.wayPointList.endPoint.replace(/__POINT__/,l)),this.options.viaPoint){for(var c=[],u=0;u<this.options.viaPoint.length;u++){var p=this.options.viaPoint[u];l=this.template.wayPointList.point,l=l.replace(/__X__/,p.x),l=l.replace(/__Y__/,p.y),c.push(l)}a=a.replace(/__VIAPOINT__/,this.template.wayPointList.viaPoint.replace(/__POINT__/,c.join("\n")))}else a=a.replace(/__VIAPOINT__/,"");return e=e.replace(/__WAYPOINTLIST__/g,a),this.requestString=e,this.requestString}},t.a=o},function(e,t){},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof o))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!e)throw new Error(s.a.getMessage("PARAM_EMPTY","options"));this.settings=e}var n=r(0),s=r(1),i=r(93);o.prototype={requestString:null,constructor:o,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var e=new i.a(this.settings),t=e.getParams(),r="",o=0;o<t.length;o++){var n=t[o];r&&(r+="&"),r+=n.k+"="+n.v}return this.logger.trace(r),this.requestString=r,this.requestString}},t.a=o},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("RouteParamREST constructor cannot be called as a function.");if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=e||{},this.origin=this.options.startPoint.x+","+this.options.startPoint.y,this.destination=this.options.endPoint.x+","+this.options.endPoint.y,this.waypoints=this.options.viaPoints||null,this.startDateTime=this.options.expectedStartTime||null,this.graphName=this.options.graph,this.srs=this.options.srs,this.exclusions=this.options.exclusions,this.method="TIME",this.options.routePreference){switch(this.options.routePreference){case"fastest":this.method="TIME";break;case"shortest":this.method="DISTANCE";break;default:this.logger.warn("Par defaut, on prend l'itinéraire le plus rapide !"),this.method="TIME"}}this.format=this.options.geometryInInstructions?"STANDARDEXT":"STANDARD",this.tolerance=10,this.profileId=null,this.profileName=null}var n=r(0);o.CLASSNAME="RouteParamREST",o.prototype={constructor:o,getWaypoints:function(){if(this.waypoints){for(var e=[],t=0;t<this.waypoints.length;t++){var r=this.waypoints[t];e.push(r.x+","+r.y)}return e.join(";")}},getExclusions:function(){return this.exclusions.join(";")}},o.prototype.getParams=function(){var e=[];return e.push({k:"origin",v:this.origin}),e.push({k:"destination",v:this.destination}),e.push({k:"method",v:this.method}),this.waypoints&&e.push({k:"waypoints",v:this.getWaypoints()}),this.startDateTime&&e.push({k:"startDateTime",v:this.startDateTime}),this.graphName&&e.push({k:"graphName",v:this.graphName}),this.exclusions&&e.push({k:"exclusions",v:this.getExclusions()}),this.srs&&e.push({k:"srs",v:this.srs}),this.format&&e.push({k:"format",v:this.format}),e},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(8),l=r(95),c=r(96),u=r(16),p=r(17),h={build:function(e){var t=o.a.getLogger("RouteResponseFactory");t.trace("RouteResponseFactory::build()");var r=null;if(!e.response)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(e.rawResponse)t.trace("analyze response : raw"),r=e.response;else{switch(e.outputFormat){case"xml":t.trace("analyze response : xml");var h="REST"===e.api?l.a:c.a;try{var f=new i.a({reader:h});if("string"==typeof e.response?f.setXMLString(e.response):f.setXMLDoc(e.response),!(r=f.parse()))throw new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT","xml"))}catch(t){return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_ANALYSE",e.response)))}break;case"json":t.trace("analyze response : json");var g;if(g="string"==typeof e.response?JSON.parse(e.response):e.response,g.message)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",g.message)));if(g){var d=[],m=[],E=[];if(r=new u.a,r.hasOwnProperty("totalTime")&&(r.totalTime=parseFloat(g.durationSeconds)),r.hasOwnProperty("totalDistance")&&(r.totalDistance="m"===e.distanceUnit?g.distanceMeters:g.distance),r.hasOwnProperty("bbox")){var _=g.bounds.split(/[,;]/);r.bbox.left=parseFloat(_[0]),r.bbox.bottom=parseFloat(_[1]),r.bbox.right=parseFloat(_[2]),r.bbox.top=parseFloat(_[3])}var v=function(e){r.routeGeometry=e},y=function(t){console.log(t),e.onError.call(e.scope,new s.a(n.a.getMessage("PARAM_FORMAT",["geometryWkt"])))};if(r.hasOwnProperty("routeGeometry")){var R=g.geometryWkt||g.simplifiedWkt;if(R&&(a.a.toJson(R,v,y),!r.routeGeometry))return}if(r.hasOwnProperty("routeInstructions")){var S,w=g.legs;if(Array.isArray(w)&&w.length)for(S=0;S<w.length;S++)d.push(w[S]);if(Array.isArray(d)&&d.length)for(S=0;S<d.length;S++)m.push(d[S].steps);if(Array.isArray(m)&&m.length)for(S=0;S<m.length;S++)E=E.concat(m[S]);E.forEach(function(t){r.routeInstructions.push(new p.a),r.routeInstructions[r.routeInstructions.length-1].duration=t.durationSeconds,r.routeInstructions[r.routeInstructions.length-1].distance="m"===e.distanceUnit?t.distanceMeters:t.distance,r.routeInstructions[r.routeInstructions.length-1].code=t.navInstruction;for(var o=[],n=0;n<t.points.length;n++){var s=t.points[n].split(",");s&&o.push(s)}switch(o&&0!==o.length?r.routeInstructions[r.routeInstructions.length-1].geometry={coordinates:o,type:"LineString"}:r.routeInstructions[r.routeInstructions.length-1].geometry=null,"Valeur non renseignée"===t.name&&(t.name=""),t.navInstruction){case"F":t.name?r.routeInstructions[r.routeInstructions.length-1].instruction="Tout droit "+t.name:r.routeInstructions[r.routeInstructions.length-1].instruction="Continuer tout droit ";break;case"B":r.routeInstructions[r.routeInstructions.length-1].instruction="Demi-tour "+t.name;break;case"L":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner à gauche "+t.name;break;case"R":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner à droite "+t.name;break;case"BL":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner très à gauche "+t.name;break;case"BR":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner très à droite "+t.name;break;case"FL":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner légèrement à gauche "+t.name;break;case"FR":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner légèrement à droite "+t.name;break;case"round_about_entry":r.routeInstructions[r.routeInstructions.length-1].instruction="Entrée rond-point "+t.name;break;case"round_about_exit":r.routeInstructions[r.routeInstructions.length-1].instruction="Sortie rond-point "+t.name;break;case null:r.routeInstructions[r.routeInstructions.length-1].instruction="Prendre tout droit "+t.name;break;default:r.routeInstructions[r.routeInstructions.length-1].instruction="?"+t.navInstruction+"? "+t.name}})}}if(!r)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_ANALYSE","json")));break;default:return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(r&&r.exceptionReport)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}e.onSuccess.call(e.scope,r)}};t.a=h},function(e,t,r){"use strict";function o(e){var t,r="";return e.hasChildNodes()&&(t=e.firstChild)&&3===t.nodeType&&(r=t.nodeValue),r}function n(e,t){if(e.hasChildNodes())for(var r,o,s=e.childNodes,i=0;i<s.length;i++)if(r=s[i],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,u.READERS[o]){var a=u.READERS[o];a(r,t)}else n(r,t)}var s=r(1),i=r(8),a=r(2),l=r(16),c=r(17),u={};u.READERS={routeResult:function(e){var t=new l.a;if(n(e,t),"error"===t.status){var r=s.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new a.a({message:r,type:a.a.TYPE_SRVERR})}return t},status:function(e,t){var r=o(e);"ERROR"!==r&&"error"!==r||t&&(t.status="error")},message:function(e,t){t&&(t.message=o(e))},distance:function(e,t){t&&(t.totalDistance=o(e))},durationSeconds:function(e,t){t&&(t.totalTime=parseFloat(o(e)))},bounds:function(e,t){if(t&&t.bbox){var r=o(e).split(/[,;]/);t.bbox.left=parseFloat(r[0]),t.bbox.bottom=parseFloat(r[1]),t.bbox.right=parseFloat(r[2]),t.bbox.top=parseFloat(r[3])}},geometryWkt:function(e,t){if(t){var r=e.innerHTML,o=function(e){t.routeGeometry=e},n=function(){var e=s.a.getMessage("PARAM_FORMAT",["geometryWkt"]);throw new Error(e)};i.a.toJson(r,o,n)}},step:function(e,t){var r,n=new c.a;if(e.hasChildNodes)for(var s,i,a=e.childNodes,l=0;l<a.length;l++)s=a[l],1===s.nodeType&&(i=s.localName||s.baseName||s.nodeName,"durationSeconds"===i?n.duration=o(s):"distance"===i?n.distance=o(s):"navInstruction"===i?n.code=o(s):"name"===i&&(r=o(s)));if(n.code)switch(n.code){case"F":n.instruction="Valeur non renseignée"!==r?"Tout droit "+r:"Continuer tout droit ";break;case"B":n.instruction="Demi-tour "+r;break;case"L":n.instruction="Tourner à gauche "+r;break;case"R":n.instruction="Tourner à droite "+r;break;case"BL":n.instruction="Tourner très à gauche "+r;break;case"BR":n.instruction="Tourner très à droite "+r;break;case"FL":n.instruction="Tourner légèrement à gauche "+r;break;case"FR":n.instruction="Tourner légèrement à droite "+r;break;case"round_about_entry":n.instruction="Entrée rond-point "+r;break;case"round_about_exit":n.instruction="Sortie rond-point "+r;break;case null:n.instruction="Prendre "+r;break;default:n.instruction="?"+n.code+"? "+r}Array.isArray(t.routeInstructions)&&t.routeInstructions.push(n)}},u.read=function(e){if("routeResult"===e.nodeName)return u.READERS.routeResult(e);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},t.a=u},function(e,t,r){"use strict";var o=r(0),n={};n.READERS={},n.read=function(e){o.a.getLogger("RouteResponseOLSReader").error("not yet implemented !")},t.a=n},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!e.position)throw new Error(s.a.getMessage("PARAM_MISSING","position"));if(null===e.position.x)throw new Error(s.a.getMessage("PARAM_MISSING","position.x"));if(null===e.position.y)throw new Error(s.a.getMessage("PARAM_MISSING","position.y"));if(!e.time&&!e.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!e.time&&e.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),e.time&&!e.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.exclusions=e.exclusions||null,this.options.graph=e.graph||"Voiture",this.options.reverse=e.reverse||!1,this.options.smoothing=e.smoothing||!1,this.options.holes=e.holes||!1,this.options.srs=e.srs||"EPSG:4326",this.options.outputFormat="string"==typeof e.outputFormat?e.outputFormat.toLowerCase():"json",!this.options.serverUrl){var t=l.a.ProcessIsoCurve.url(this.options.apiKey),r=t["iso-"+this.options.outputFormat];if(!r)throw new Error("Url by default not found !");this.options.serverUrl=r,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var c=this.options.serverUrl.substring(i+1);if(c&&c.length<5)switch(this.logger.trace("Serveur Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(5),c=r(98),u=r(100);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(e,t){try{var r=new c.a(this.options);if(!r.processRequestString())throw new Error(s.a.getMessage("SERVICE_REQUEST_BUILD"));this.request=r.requestString}catch(t){return void e.call(this,new i.a(t.message))}t.call(this,this.request)},o.prototype.analyzeResponse=function(e,t){if(this.response){var r={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};u.a.build(r)}else e.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},t.a=o},function(e,t,r){"use strict";function o(e){if(this.logger=n.a.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof o))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!e)throw new Error(s.a.getMessage("PARAM_EMPTY","options"));this.settings=e,this.mode=this.settings.httpMethod||"GET"}var n=r(0),s=r(1),i=r(99);o.prototype={requestString:null,constructor:o,template:{container:'<?xml version="1.0" encoding="UTF-8"?>\n<isochroneRequest>\n__ID__\t<location>\n\t\t<x>__X__</x>\n\t\t<y>__Y__</y>\n\t</location>\n\t<srs>__SRS__</srs>\n\t<graphName>__GRAPHNAME__</graphName>\n__PROFIL____EXCLUSIONS__\t<method>__METHOD__</method>\n__TIME____DISTANCE__\t<reverse>__REVERSE__</reverse>\n\t<smoothing>__SMOOTHING__</smoothing>\n\t<holes>__HOLES__</holes>\n</isochroneRequest>',id:"\t<id>__IDVALUE__</id>\n",profil:"\t<profileId>__PROFILID__</profileId>\n\t<profileName>__PROFILNAME__</profileName>\n",exclusions:{container:"\t<exclusions>\n__EXCLUSIONFEATURE__\n\t</exclusions>\n",feature:"\t\t<exclusion>__EXCLUSIONVALUE__</exclusion>"},time:"\t<time>__TIMEVALUE__</time>\n",distance:"\t<distance>__DISTANCEVALUE__</distance>\n"},processRequestString:function(){var e="",t=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var r=new i.a(this.settings),o=r.getParams();for(t=0;t<o.length;t++){var n=o[t];e&&(e+="&"),e+=n.k+"="+n.v}break;case"POST":if(this.logger.trace("Process POST Request"),e=this.template.container,e=e.replace(/__ID__/g,""),e=e.replace(/__PROFIL__/g,""),e=e.replace(/__X__/g,this.settings.position.x),e=e.replace(/__Y__/g,this.settings.position.y),e=e.replace(/__GRAPHNAME__/g,this.settings.graph),e=e.replace(/__SRS__/g,this.settings.srs),e=e.replace(/__SMOOTHING__/g,this.settings.smoothing),e=e.replace(/__HOLES__/g,this.settings.holes),e=e.replace(/__REVERSE__/g,this.settings.reverse),this.settings.exclusions){var s=this.template.exclusions.container,a=[];for(t=0;t<this.settings.exclusions.length;t++){var l=this.template.exclusions.feature;l=l.replace(/__EXCLUSIONVALUE__/,this.settings.exclusions[t]),a.push(l)}s=s.replace(/__EXCLUSIONFEATURE__/,a.join("\n")),e=e.replace(/__EXCLUSIONS__/g,s)}if(e=e.replace(/__EXCLUSIONS__/g,""),this.settings.distance){var c=this.template.distance;c=c.replace(/__DISTANCEVALUE__/g,this.settings.distance),e=e.replace(/__DISTANCE__/g,c),e=e.replace(/__METHOD__/g,"distance")}if(e=e.replace(/__DISTANCE__/g,""),this.settings.time){var u=this.template.time;u=u.replace(/__TIMEVALUE__/g,this.settings.time),e=e.replace(/__TIME__/g,u),e=e.replace(/__METHOD__/g,"time")}e=e.replace(/__TIME__/g,"");break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(e),this.requestString=e,this.requestString}},t.a=o},function(e,t,r){"use strict";function o(e){if(!(this instanceof o))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");switch(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=e||{},this.id=this.options.id,this.location=this.options.position,this.srs=this.options.srs,this.graphName=this.options.graph,this.profileId=this.options.profileId||null,this.profileName=this.options.profileName||null,this.exclusions=this.options.exclusions,this.reverse=this.options.reverse,this.smoothing=this.options.smoothing,this.holes=this.options.holes,this.options.method){case"time":this.method="time",this.time=this.options.time;break;case"distance":this.method="distance",this.distance=this.options.distance;break;default:this.logger.warn("Par defaut, on calcule un isochrone !"),this.method="time"}}var n=r(0);o.CLASSNAME="ProcessIsoCurveParam",o.prototype={constructor:o,getLocation:function(){return this.location.x+","+this.location.y},getExclusions:function(){return this.exclusions.join(";")}},o.prototype.getParams=function(){var e=[];return e.push({k:"location",v:this.getLocation()}),e.push({k:"smoothing",v:this.smoothing}),e.push({k:"holes",v:this.holes}),e.push({k:"reverse",v:this.reverse}),e.push({k:"method",v:this.method}),this.time&&e.push({k:"time",v:this.time}),this.distance&&e.push({k:"distance",v:this.distance}),e.push({k:"graphName",v:this.graphName}),this.exclusions&&e.push({k:"exclusions",v:this.getExclusions()}),this.srs&&e.push({k:"srs",v:this.srs}),e},t.a=o},function(e,t,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(8),l=r(101),c=r(18),u={build:function(e){var t=o.a.getLogger("ProcessIsoCurveResponseFactory");t.trace(["ProcessIsoCurveResponseFactory::build()"]);var r=null;if(!e.response)return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(e.rawResponse)t.trace("analyze response : raw"),r=e.response;else{switch(e.outputFormat){case"xml":t.trace("analyze response : xml");try{var u=new i.a({reader:l.a});if("string"==typeof e.response?u.setXMLString(e.response):u.setXMLDoc(e.response),!(r=u.parse()))throw new Error(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(t){var p=t.message;return p+="\n (raw response service : '"+e.response+"')",void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",p),status:200,type:s.a.TYPE_SRVERR}))}break;case"json":t.trace("analyze response : json");var h;if(h="string"==typeof e.response?JSON.parse(e.response):e.response,"OK"===h.status||"ok"===h.status){if(!(r=new c.a))return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_ANALYSE",e.response)));r.time=h.time,r.distance=h.distance,r.message=h.message,r.id=h.id,r.srs=h.srs;var f=function(e){r.geometry=e},g=function(){e.onError.call(e.scope,new s.a({message:n.a.getMessage("PARAM_FORMAT","wktGeometry")}))};if(r.hasOwnProperty("geometry")&&(a.a.toJson(h.wktGeometry,f,g),!r.geometry))return;var d=h.location.split(",");r.location&&(r.location.x=d[0],r.location.y=d[1])}else if("ERROR"===h.status||"error"===h.status){var m=h.message;return m+="\n (raw response service : '"+h+"')",void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",m)))}break;default:return void e.onError.call(e.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(r&&r.exceptionReport)return void e.onError.call(e.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",r.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,r)}};t.a=u},function(e,t,r){"use strict";function o(e){var t,r="";return e.hasChildNodes()&&(t=e.firstChild)&&3===t.nodeType&&(r=t.nodeValue),r}var n=r(1),s=r(8),i=r(2),a=r(18),l={};l.READERS={isochronResult:function(e){var t=new a.a;if(e.hasChildNodes())for(var r,o=e.childNodes,s=0;s<o.length;s++)r=o[s],l.READERS[r.nodeName]&&l.READERS[r.nodeName](r,t);if("error"===t.status){var c=n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new i.a({message:c,type:i.a.TYPE_SRVERR})}return t},message:function(e,t){t&&(t.message=o(e))},status:function(e,t){var r=o(e);"ERROR"!==r&&"error"!==r||t&&(t.status="error")},id:function(e,t){t&&(t.id=o(e))},location:function(e,t){var r=o(e);t&&t.location&&(t.location.x=parseFloat(r.split(",")[0]),t.location.y=parseFloat(r.split(",")[1]))},srs:function(e,t){t&&(t.srs=o(e))},distance:function(e,t){t&&(t.distance=parseFloat(o(e)))},time:function(e,t){t&&(t.time=parseFloat(o(e)))},wktGeometry:function(e,t){if(t){var r=e.innerHTML,o=function(e){t.geometry=e},i=function(){var e=n.a.getMessage("PARAM_FORMAT",["wktGeometry"]);throw new Error(e)};t.hasOwnProperty("geometry")&&s.a.toJson(r,o,i)}},serviceResult:function(e){var t={};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++)r=o[n],l.READERS[r.nodeName]&&l.READERS[r.nodeName](r,t);return t},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var r,o=e.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(t.exceptionReport=l.READERS.Exception(r));return t},Exception:function(e){var t={},r=e.getAttribute("exceptionCode");r&&(t.exceptionCode=r);var o=e.firstChild;return o&&3===o.nodeType&&(t.exception=o.nodeValue),t}},l.read=function(e){var t;if("isochronResult"===e.nodeName||"isochroneResult"===e.nodeName||"IsochroneResult"===e.nodeName)return t=l.READERS.isochronResult(e);if("ExceptionReport"===e.nodeName)return t=l.READERS[e.nodeName](e);if(l.READERS[e.nodeName]){if(t=l.READERS[e.nodeName](e),"error"===t.status){var r=n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new i.a({message:r,type:i.a.TYPE_SRVERR})}return t}throw new i.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE",e.nodeName),type:i.a.TYPE_UNKERR})},t.a=l}]).default});